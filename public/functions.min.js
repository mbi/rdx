import{timeago}from"./utils.min.js?v=Ju1nOUjt";import{replaceRedditLinks,htmlDecode}from"./html.min.js?v=Ju1nOUjt";import{okzoomer,gestureToMatrix,getOrigin,applyMatrix}from"./ok-gesture.min.js?v=Ju1nOUjt";var bmr="",seenPostIds=[],activePostIdx=0,activeCommentIdx=0,nexturl="",nextseturl="",selectedSeachResult=null;if(null!==JSON.parse(localStorage.getItem("subs"))){var subslisted="",subslistedarray=JSON.parse(localStorage.getItem("subs"));for(var x in subslistedarray.sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())})),subslistedarray)subslisted+='<a href="subreddit.html?r='+subslistedarray[x]+'" class="homelinks">'+subslistedarray[x]+"</a>";document.getElementById("subscribed").innerHTML=subslisted}var curinfi=localStorage.getItem("curinfi")||!0;if(-1==window.location.href.indexOf("comments.html")&&curinfi){var style=document.createElement("style");style.innerHTML=".footer, .infotext, .next {display:none !important}",document.head.appendChild(style)}export function toggle(e){for(var t=document.getElementsByClassName("show"),n=0;n<t.length;n++)t[n].id!=e&&(t[n].classList.toggle("hidden"),t[n].classList.toggle("show"));document.getElementById(e).classList.toggle("hidden"),document.getElementById(e).classList.toggle("show"),"subssearch"===e&&document.getElementById("subssearchi").focus()}export function makereq(e){e=e.replace(/www.reddit.com/g,"old.reddit.com");var t,n="",o=new XMLHttpRequest;o.responseType="json",o.open("GET",e,!0),o.onload=function(){var l=o.response,s=e.replace("https://old.reddit.com/r/","");s=s.replace("/.json","");var i=l.data.children.filter((e=>-1===seenPostIds.indexOf(e.id)));for(var a in i)t=i[a].data,n+=postbuilder(t),seenPostIds.push(t.id);n+='<div class="navigate">';var r=window.location.href.replace(/\&after.*/,"");null!=l.data.after&&(-1===r.indexOf("?")&&(r+="?a=b"),n+='<a class="next" href="'+r+"&after="+l.data.after+'">Next page</a><div id="sxpy"></div><div id="sentinel"> </div>',nextseturl=r+"&after="+l.data.after,nexturl=e.split("&after")[0]+"&after="+l.data.after),n+="</div>",document.getElementById("body").innerHTML=n,runhsl(),curinfi&&observe(),postsLoadedCallback(!0)},o.onerror=function(e){document.getElementById("body").innerHTML="<center style=\"padding:15px;\">Can't load content!<br><small>There can be multiple reasons for this, your browser's aggresive privacy settings may be blocking the one call to reddit.com RDX makes. This happens usually when you use a VPM/Proxy and/or a privacy focused browser like Firefox.<br> Play around with privacy/tracking options or change your browser. If it still doesn't work click the feedback link and send me some info.</small></center>",document.getElementById("body").innerHTML+='<code style="padding:15px; margin-top: 1rem; border: 1px solid>'+e.target.status+"</code>"},o.send(null)}var _is_requesting=!1;function scrollMore(){if(_is_requesting)return;var t;_is_requesting=!0;const n=nexturl.replace(/www.reddit.com/g,"old.reddit.com");let o="";if(""==nexturl)return!1;console.log(nexturl);var l=new XMLHttpRequest;l.responseType="json",l.open("GET",n,!0),l.onload=function(){var e=l.response,s=e.data.children.filter((e=>-1===seenPostIds.indexOf(e.id)));for(var i in s)t=s[i].data,o+=postbuilder(t),seenPostIds.push(t.id);var a=window.location.href.replace(/\&after.*/,"");null!=e.data.after?(-1===a.indexOf("?")&&(a+="?a=b"),history.pushState("","newtitle",nextseturl),nextseturl=a+"&after="+e.data.after,nexturl=(nexturl=n.split("&after")[0])+"&after="+e.data.after):nexturl="",document.getElementById("sxpy").insertAdjacentHTML("beforeend",o),document.getElementById("sentinel").innerHTML=" ",runhsl(),postsLoadedCallback(!1),_is_requesting=!1},l.onerror=function(){document.getElementById("sxpy").innerHTML+='<center style="padding:15px;">Can\'t load content! Refresh the page or try again later.</center>',document.getElementById("body").innerHTML+='<code style="padding:15px; margin-top: 1rem; border: 1px solid>'+e.target.status+"</code>",nexturl="",_is_requesting=!1},l.send(null)}function observe(){var e=!1;const t=new IntersectionObserver((function(t,n){t.forEach((t=>{t.isIntersecting&&0==e&&(document.getElementById("sentinel").innerHTML="<center>Loading more posts..</center>",e=!0,setTimeout((()=>{scrollMore(),e=!1}),100))}))}),{root:null,threshold:1}),n=document.getElementById("sentinel");n&&t.observe(n)}function addlc(e,t){var n=JSON.parse(localStorage.getItem(e)||"[]");n.push(t),localStorage.setItem(e,JSON.stringify(n))}export function checklc(e,t){return JSON.parse(localStorage.getItem(e)||"[]").includes(t)}function removelc(e,t){var n=JSON.parse(localStorage.getItem(e)||"[]");n=n.filter((function(e){return e!==t})),localStorage.setItem(e,JSON.stringify(n))}function searchsubs(e,t){bmr&&bmr.abort();var n=t.keyCode||t.charCode;let o=document.getElementById("subslist");if(38!==n&&40!==n){var l=new XMLHttpRequest;bmr=l,l.onreadystatechange=function(){if(4===l.readyState&&200==l.status){var e="";let n=l.response.subreddits.filter((e=>e.numSubscribers));for(var t in n.sort(((e,t)=>t.numSubscribers-e.numSubscribers)),n){e+='<a class="sub-result" style="background-image:url('+(n[t].icon||n[t].communityIcon||"/favicon.png")+')" href="subreddit.html?r='+n[t].name+'">'+n[t].name+"</a>"}o.innerHTML=e,selectedSeachResult=null}},l.responseType="json",l.open("GET","https://old.reddit.com/api/subreddit_autocomplete/.json?query="+e+"&include_profiles=false&include_over_18=true",!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.send()}if(e.length>1)if(13===n)window.location="subreddit.html?r="+document.getElementById("subssearchi").value;else if(38===n){if(0===subslist.querySelectorAll("a").length)return;"number"==typeof selectedSeachResult?selectedSeachResult--:selectedSeachResult=selectedSeachResult=subslist.querySelectorAll("a").length-1,selectedSeachResult<0&&(selectedSeachResult=selectedSeachResult=subslist.querySelectorAll("a").length-1),subslist.querySelectorAll("a").forEach((e=>{e.classList.remove("selected")})),subslist.querySelectorAll("a")[selectedSeachResult].classList.add("selected"),document.getElementById("subssearchi").value=subslist.querySelectorAll("a")[selectedSeachResult].innerText}else if(40===n){if(0===subslist.querySelectorAll("a").length)return;"number"==typeof selectedSeachResult?selectedSeachResult++:selectedSeachResult=0,selectedSeachResult>subslist.querySelectorAll("a").length-1&&(selectedSeachResult=0),subslist.querySelectorAll("a").forEach((e=>{e.classList.remove("selected")})),subslist.querySelectorAll("a")[selectedSeachResult].classList.add("selected"),document.getElementById("subssearchi").value=subslist.querySelectorAll("a")[selectedSeachResult].innerText}}function unsubscribe(e){removelc("subs",e),subbtn=document.getElementById("subbtn"),subbtn.innerHTML="Subscribe"}function subscribe(e){addlc("subs",e),subbtn=document.getElementById("subbtn"),subbtn.innerHTML="Unsubscribe"}export function postbuilder(e){var t="";let n=localStorage.getItem("curmode")||"original";-1!=window.location.href.indexOf("comments.html")&&(n="original");var o=timeago(1e3*e.created_utc),l=e.stickied?" sticky":" ",s="";1!=checklc("a18","yes")&&(s=e.over_18?"over18":" ");var i="moderator"==e.distinguished?" moderator":" ";if(t+='<div class="post '+n+'" id="'+e.id+'">',"comp"==n)if(thumbnail=e.thumbnail,"self"!=thumbnail&&"spoiler"!=thumbnail&&"default"!=thumbnail&&""!=thumbnail&&"nsfw"!=thumbnail)"image"==thumbnail&&(thumbnail=e.preview.images[0].resolutions[0].url),t+='<div class="compthumb"><img src="'+thumbnail+'" alt="thumbnail"/></div><div class="rop">';else{thumbnail=thumbnail||"&bull;";const n=e?.preview?.images?.[0]?.resolutions?.[0]?.url||"none";t+="none"!=n?'<div class="compthumb"><img src="'+n+'" alt="thumbnail"/></div><div class="rop">':'<div class="comptext">'+thumbnail+'</div><div class="rop">'}if(t+='<div class="post_link'+l+" "+i+'"><a href="comments.html?url=https://www.reddit.com'+e.permalink+'">'+e.title+"</a></div>","comp"!=n){if(null!=e.selftext_html){var a=replaceRedditLinks(e.selftext_html);t+='<div class="postc selftext"><overflow-toggle show="+" hide="">'+htmlDecode(a)+"</overflow-toggle></div>"}var r=e.url_overridden_by_dest;e.url&&e.url.includes("reddit.com/gallery")&&(r=e.url),null!=e.crosspost_parent_list&&e.crosspost_parent_list.length>0||void 0!==e.crosspost_parent_list&&e.crosspost_parent_list.length>0?t+=postbuilder(e.crosspost_parent_list[0]):(void 0!==r&&null==e.removed_by_category&&(t+='<div class="urlpreview '+s+'">'+urlpreview(r,e)+"</div>"),null!=e.removed_by_category&&(t+="Removed by "+e.removed_by_category),null!=e.poll_data&&(t+=pollbuilder(e)))}return t=t+'<div class="post_meta"><div class="flex-left"><a class="comments-icon icon" href="comments.html?url=https://old.reddit.com'+e.permalink+'">'+e.num_comments+'</a><span class="upvotes-icon icon">'+e.score+'</span><a class="ext-url-icon icon" href="'+e.url+'"></a>',t+='</div><div class="post_author flex-right"><a href="subreddit.html?r='+e.subreddit+'">'+e.subreddit_name_prefixed+'</a> <a class="small-hidden" href="user.html?u='+e.author+'">'+e.author+"</a> "+o+"</div>",null!==localStorage.getItem("refreshToken")&&window.location.href.includes("comments.html")&&(t+=" &bull; <span onclick=\"replyto('t3_"+e.id+"')\">Reply</span>"),t+="</div>","comp"==n&&(t+="</div>"),t+="</div>"}function preloadImage(e){let t=document.createElement("div");t.innerHTML=`<img src="${e}" />`,document.body.appendChild(t),setTimeout((function(){document.body.removeChild(t)}),1)}function closegal(){document.getElementById("newgallery").outerHTML=""}function galleryopen(e){const t=document.createElement("div");t.id="newgallery",document.getElementsByTagName("body")[0].appendChild(t),t.innerHTML='<span id="closegal" onclick="closegal();">Close</span>',document.querySelectorAll('[data-id="'+e+'"]').forEach((e=>{t.innerHTML+='<div class="displayimg"><img src="'+e.getAttribute("data-msrc")+'"></div>'}))}function previewImage(e){var t;try{var n=e.preview.images[0].resolutions[0];e.preview.images[0].resolutions.forEach((e=>{e.width&&e.width>=n.width&&e.width<=640&&(n=e)})),t=n.url}catch(n){t=e.thumbnail}return"default"===t&&(t=""),t}function urlpreview(e,t){var n="";if(e.match(/.(jpg|jpeg|png)$/i))n+='<div class="postc singleimage"><img src="'+e+'"/></div>';else if(e.match(/.(gif)$/i)){const l=t?.preview?.images?.[0]?.variants?.mp4?.source?.url||"none";if("none"==l)n+='<div class="postc singleimage"><img src="'+e+'"/></div>';else{c=void 0===(c=t.preview)?t.thumbnail:t.preview.images[0].source.url;var o=previewImage(t);n+='<div class="postc video generic-gif">',n+='<a href="#" data-target="'+t.id+'" class="lazy-video imgur-com">',n+='<img  loading="lazy" src="'+o+'#t=0.001"/>',n+="</a>",n+='<template id="vt-'+t.id+'">',n+='<video id="v'+t.id+'" src="'+l+'#t=0.001" poster="'+o+'" width="100%" preload="none" loop controls>',n+="</video>",n+="</template>",n+="</div>"}}else if(e.match(/www.reddit.com\/gallery/g)){n+='<div class="postc gallery">';let e=t.media_metadata,o=t.gallery_data;const i={};o&&e&&o.items.forEach(((t,n)=>{const o=t.media_id;e.hasOwnProperty(o)&&(i[o]=e[o])}));for(var l in n+='<slide-show controls="pagination navigation" loop>',i)if("failed"!=i[l].status&&"unprocessed"!=i[l].status){var s=i[l].s.u;s=void 0===s?i[l].s.gif:s.replace("preivew.redd","i.redd");i[l].p[0].u;n+='<img style="width:100%;height:auto" draggable="false" src="'+s+'" />'}n+="</slide-show>",n+="</div>"}else if(e.match(/v.redd.it/g)){if(n+='<div class="postc video vreddit">',null!=t.secure_media){var i=t.secure_media.reddit_video.dash_url,a=t.secure_media.reddit_video.hls_url,r=t.secure_media.reddit_video.fallback_url,c=t.preview;c=void 0===c?t.thumbnail:t.preview.images[0].source.url,(o=previewImage(t))?(n+='<a href="#" data-target="'+t.id+'" class="lazy-video">',n+='<img loading="lazy" src="'+o+'#t=0.001"/>',n+="</a>",n+='<template id="vt-'+t.id+'">',n+='<video id="v'+t.id+'" src="'+i+'#t=0.001" data-fallback="'+r+'" data-hls="'+a+'" poster="'+c+'" width="100%" preload="metadata" class="reddit_hls"  controls>',n+="</video>",n+="</template>"):(n+='<video id="v'+t.id+'" src="'+i+'#t=0.001" data-fallback="'+r+'" data-hls="'+a+'" poster="'+c+'" width="100%" preload="metadata" class="reddit_hls"  controls>',n+="</video>")}else n+="crosspost";n+="</div>"}else if(e.match(/redgifs/g)&&t.preview){if(n+='<div class="postc video redgifs">',t.secure_media)if(void 0===(i=t.secure_media.oembed.thumbnail_url))n+=i='<iframe src="'+(i=e.replace("redgifs.com/watch/","redgifs.com/ifr/"))+'?autoplay=0" class="gifframe"></iframe>';else{t.preview&&void 0!==t.preview.reddit_video_preview?i=t.preview.reddit_video_preview.fallback_url:t.secure_media.oembed.thumbnail_url&&(i=t.secure_media.oembed.thumbnail_url),i=i.replace("size_restricted.gif","mobile.mp4");o=previewImage(t);n+='<a href="#" data-target="'+t.id+'" class="lazy-video">',n+='<img  loading="lazy" src="'+o+'#t=0.001"/>',n+="</a>",n+='<template id="vt-'+t.id+'">',n+='<video id="v'+t.id+'" src="'+i+'" poster="'+o+'" width="100%" preload="metadata" controls>',n+="</video>",n+="</template>"}n+="</div>"}else if(e.match(/gfycat.com/g))n+='<div class="postc video gyfcat">',null==t.secure_media||void 0===t.secure_media.oembed.thumbnail_url?n+=i='<iframe src="'+(i=e.replace("gfycat.com/","gfycat.com/ifr/"))+'?autoplay=0" class="gifframe"></iframe>':(void 0!==t.preview.reddit_video_preview?i=t.preview.reddit_video_preview.fallback_url:t.secure_media.oembed.thumbnail_url&&(i=t.secure_media.oembed.thumbnail_url),n+='<video src="'+(i=i.replace("size_restricted.gif","mobile.mp4"))+'" poster="'+t.thumbnail+'" width="100%" height="240" preload="metadata" controls> </video>'),n+="</div>";else if(e.match(/i.imgur.com(.*?)gifv/g)){n+='<div class="postc video imgur">';let l=e.replace(".gifv",".mp4");o=previewImage(t);n+='<a href="#" data-target="'+t.id+'" class="lazy-video">',n+='<img  loading="lazy" src="'+o+'#t=0.001"/>',n+="</a>",n+='<template id="vt-'+t.id+'">',n+='<video  id="v'+t.id+'" src="'+l+'" poster="'+o+'#t=0.001" width="100%" preload="none" controls class="lazy">',n+="</video>",n+="</template>",n+="</div>"}else{var d=previewImage(t)||"";d?(n+='<a href="'+e+'" class="postc singleimage url">',n+='<img src="'+d+'"/>',n+="</a>"):n+='<div class="postc link"><a href="'+e+'" >'+d+e+"</a></div>",n=replaceRedditLinks(n)}return n}function pollbuilder(e){let t='<div class="poll">';for(var n in e.poll_data.options){let o=e.poll_data.options[n].vote_count;void 0===o&&(o=" "),t+='<div class="polloption"><span class="polloptiontext">'+e.poll_data.options[n].text+'</span> <span  class="votecount">'+o+"</span>"," "!=o&&(t+='<div class="optionmeter" style="width:'+e.poll_data.options[n].vote_count/e.poll_data.total_vote_count*100+'%;"></div>'),t+="</div>"}return t+='<div class="totalvotes">Total votes: '+e.poll_data.total_vote_count+"</div>",t+="</div>",t}function playaud(e){document.getElementById(e).play()}function pauseaud(e){document.getElementById(e).pause()}function seeked(e){document.getElementById("a"+e).currentTime=document.getElementById("v"+e).currentTime}export function getget(e,t=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function runhsl_on_vid(e){e.parentElement;e.classList.add("goner");if(/iPhone|iPad/i.test(navigator.userAgent))e.src=e.getAttribute("data-hls");else{dashjs.MediaPlayer().create().initialize(e,e.src,!0)}}function runhsl(){document.querySelectorAll(".reddit_hls:not(.goner)").forEach((e=>{e.parentElement;e.classList.add("goner");if(/iPhone|iPad/i.test(navigator.userAgent))e.src=e.getAttribute("data-hls");else{dashjs.MediaPlayer().create().initialize(e,e.src,!1)}}));document.querySelectorAll(".gtumb").forEach((e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-id");document.getElementById("mi_"+e).src=this.getAttribute("data-msrc"),document.querySelectorAll('[data-id="'+e+'"]').forEach((e=>e.classList.remove("actv"))),this.classList.add("actv"),document.getElementById("mi_"+e).scrollIntoView()}))}))}function shareit(){if(navigator.share){const e=window.location.href,t={title:document.title,url:e};navigator.share(t).then((()=>{console.log("Shared successfully")})).catch((e=>{console.error("Error sharing:",e)}))}else{const e=window.location.href,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),alert("Link copied to clipboard: "+e)}}function replyto(e){document.getElementById("popitup").style.display="block",document.getElementById("cmtid").value=e,document.getElementById("actype").value="c";let t=e.replace(/^(t1_|t3_)/,"");"post"!=document.getElementById(t).className?document.getElementById("helptext").textContent="Reply to: "+document.getElementById(t).querySelector(".comment_text").textContent:document.getElementById("helptext").textContent="Reply to:"+document.getElementById(t).querySelector(".post_link a").textContent,document.getElementById("commentText").focus()}function editto(e){document.getElementById("popitup").style.display="block",document.getElementById("cmtid").value=e;let t=e.replace(/^(t1_|t3_)/,"");document.getElementById("commentText").value=document.getElementById(t).querySelector(".comment_text").textContent,document.getElementById("actype").value="e",document.getElementById("helptext").textContent="Editing: "+document.getElementById(t).querySelector(".comment_text").textContent,document.getElementById("commentText").focus()}function deleteto(e){confirm("Are you sure you want to delete this?")&&(document.getElementById("cmtid").value=e,document.getElementById("actype").value="d",apiAction())}function inboxto(){document.getElementById("actype").value="i",apiAction()}function apiAction(){const e=localStorage.getItem("accessToken"),t=localStorage.getItem("expiresIn"),n=localStorage.getItem("refreshToken"),o=localStorage.getItem("clientId"),l=localStorage.getItem("clientSecret"),s=document.getElementById("actype").value;if(e&&t){const i=Date.now(),a=parseInt(t);if(i<a)"c"==s?submitComment(e):"e"==s?editComment(e):"d"==s?delComment(e):"i"==s&&getInbox(e);else{fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${btoa(`${o}:${l}`)}`},body:`grant_type=refresh_token&refresh_token=${n}`}).then((e=>e.json())).then((t=>{const n=t.access_token,o=t.refresh_token,l=t.expires_in,a=i+1e3*l;localStorage.setItem("accessToken",n),localStorage.setItem("refreshToken",o),localStorage.setItem("expiresIn",a.toString()),"c"==s?submitComment(e):"e"==s?editComment(e):"d"==s?delComment(e):"i"==s&&getInbox(e)})).catch((e=>{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",alert("Error refreshing token:",e)}))}}else window.location.href="login.html"}function submitComment(e){document.getElementById("cmntbtn").disabled=!0,document.getElementById("cmntbtn").innerHTML="Submitting...";const t=document.getElementById("cmtid").value,n=document.getElementById("commentText").value;fetch("https://oauth.reddit.com/api/comment",{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"},body:`api_type=json&text=${encodeURIComponent(n)}&thing_id=${t}`}).then((e=>e.json())).then((e=>{if(e.errors&&e.errors.length>0)document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",alert("Error submitting comment:"+e.errors);else{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",document.getElementById("popitup").style.display="none",document.getElementById("commentText").value="";let e=t.replace(/^(t1_|t3_)/,""),o="ccp0";if("post"!=document.getElementById(e).className){let t=document.getElementById(e).className.match(/ccp\d+/)[0].replace("ccp","");t=Math.floor(t)+1,o="ccp"+t}document.getElementById(e).insertAdjacentHTML("afterEnd",'<div class="comment '+o+'"><div class="comment_author"><span class="authorttext ">You</span>  <span class="comment_meta">1 votes • Just now </span></div><div class="comment_text">'+n+"</div></div>")}})).catch((e=>{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").value="Submit",alert("Error submitting comment:"+e)}))}function editComment(e){document.getElementById("cmntbtn").disabled=!0,document.getElementById("cmntbtn").innerHTML="Submitting...";const t=document.getElementById("cmtid").value,n=document.getElementById("commentText").value;fetch("https://oauth.reddit.com/api/editusertext",{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"},body:`api_type=json&text=${encodeURIComponent(n)}&thing_id=${t}`}).then((e=>e.json())).then((e=>{if(e.errors&&e.errors.length>0)document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",alert("Error editing comment:"+e.errors);else{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").value="Submit",document.getElementById("popitup").style.display="none",document.getElementById("commentText").value="";let e=t.replace(/^(t1_|t3_)/,"");document.getElementById(e).querySelector(".comment_text").textContent=n}})).catch((e=>{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",alert("Error editing comment:"+e)}))}function delComment(e){const t=document.getElementById("cmtid").value;fetch("https://oauth.reddit.com/api/del",{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"},body:`id=${t}`}).then((e=>e.json())).then((e=>{if(e.errors&&e.errors.length>0)alert("Error deleting comment:"+e.errors);else{let e=t.replace(/^(t1_|t3_)/,"");document.getElementById(e).style.display="none"}})).catch((e=>{alert("Error deleting comment:"+e)}))}function getInbox(e){fetch("https://oauth.reddit.com/message/inbox",{method:"GET",headers:{Authorization:`Bearer ${e}`}}).then((e=>e.json())).then((e=>{if(e.error)console.error("Error fetching inbox messages:",e.error);else{const t=e.data.children;console.log(t);let n="";t.forEach((e=>{const{kind:t,inboxMessages:{author:o,created_utc:l,subject:s,link_title:i,body_html:a,tname:r,context:c}}=e,d=new Date(1e3*l),m=`${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()} - ${d.getHours()}:${d.getMinutes()}`;"t1"===t?(n+=`<div class="inboxmsgwrap"><div class="ibxmeta"><span class="ibxauthor"><a href="user.html?u=${o}">u/${o}</a> &bull;  <span class="ibxtime">${m}</span></span></div>`,n+=`<div class="ibxsub">${s}</div>`,n+=`<div class="ibxlink"><a href="comments.html?url=https://www.reddit.com${c}">${i}</a></div>`,n+=`<div class="ibxmsg">${a}</div>`,n+=`<div class="ibxactions"><button onclick="replyto('${r}')">Reply</button></div></div>`):"t4"===t&&(n+=`<div class="inboxmsgwrap"><div class="ibxmeta"><span class="ibxauthor"><a href="user.html?u=${o}">u/${o}</a> &bull;  <span class="ibxtime">${m}</span></span></div>`,n+=`<div class="ibxsub">${s}</div>`,n+=`<div class="ibxmsg">${a}</div></div>`,n+=`<div class="ibxactions"><button onclick="replyto('${r}')">Reply</button></div></div>`)})),document.getElementById("inboxbody").innerHTML=n}})).catch((e=>{console.error("Error fetching inbox messages:",e)}))}function setupUnloadVideo(e){const t=new IntersectionObserver((t=>{if(t[0].intersectionRatio<=0){let t=e.parentNode&&e.parentNode.querySelector(".lazy-video.hidden");t&&(t.classList.remove("hidden"),e.remove())}}));setTimeout((()=>{t.observe(e)}),1e3)}function is_fullscreen(){return!!document.fullscreenElement}function setupPauseVideo(e){new IntersectionObserver((t=>{t[0].intersectionRatio<=0&&e.pause()})).observe(e)}function nextItem(e=!1){++activePostIdx>document.querySelectorAll(".post").length-1&&(activePostIdx=document.querySelectorAll(".post").length-1),activatePost(e)}function nextComment(){for(var e=document.querySelectorAll(".comment"),t=activeCommentIdx+1;t<e.length;t++)if(!e[t].classList.contains("collapsed-hidden")){activeCommentIdx=t;break}activateComment(!0)}function prevItem(e=!1){--activePostIdx<0&&(activePostIdx=0),activatePost(e)}function prevComment(){for(var e=document.querySelectorAll(".comment"),t=activeCommentIdx-1;t>=0;t--)if(!e[t].classList.contains("collapsed-hidden")){activeCommentIdx=t;break}activateComment(!0)}function openComment(){var e=document.querySelector(".current-comment");e&&collapseComment(e)}function collapseCurrentComment(){var e=document.querySelector(".current-comment");e&&collapseComment(e)}function openItem(){var e=document.querySelector(".current-post");e&&(e.querySelector("a.lazy-video")?e.querySelector("a.lazy-video").click():e.querySelector(".singleimage.url")?window.location.href=e.querySelector(".singleimage.url").href:e.querySelector(".singleimage img")&&(document.body.classList.contains("jw-modal-open")?closeModal():postModal(e)))}function checkVisible(e){var t=e.getBoundingClientRect(),n=Math.max(document.documentElement.clientHeight,window.innerHeight);return!(t.bottom<0||t.top-n>=48)}function activateComment(e=!1){var t=document.querySelector(".current-comment");t&&t.classList.remove("current-comment"),document.querySelector(".comment")&&(t=document.querySelectorAll(".comment")[activeCommentIdx]).classList.add("current-comment"),t&&!checkVisible(t)&&window.scrollTo({top:t.offsetTop-46,behavior:"smooth"})}function activatePost(e=!1){var t=document.querySelector(".current-post");t&&t.classList.remove("current-post"),document.querySelector(".post")&&(t=document.querySelectorAll(".post")[activePostIdx]).classList.add("current-post"),e&&t&&window.scrollTo({top:t.offsetTop-46,behavior:"smooth"})}const _closeModalHandler=function(e){if(document.body.classList.contains("jw-modal-open"))return closeModal(),e.preventDefault(),!1};function initGestures(e){if(!window.DOMMatrix){if(!window.WebKitCSSMatrix)throw new Error("Couldn't find a DOM Matrix implementation");window.DOMMatrix=window.WebKitCSSMatrix}let t,n=new DOMMatrix;e.style.transformOrigin="0 0",okzoomer(document.querySelector("#dialog"),{startGesture(o){e.style.transform="",t=getOrigin(e,o),applyMatrix(e,gestureToMatrix(o,t).multiply(n))},doGesture(o){applyMatrix(e,gestureToMatrix(o,t).multiply(n))},endGesture(o){n=gestureToMatrix(o,t).multiply(n),applyMatrix(e,n)}})}function postModal(e){if(document.body.offsetWidth<480)return;let t=document.querySelector("#dialog");if(e.querySelector(".singleimage img")){var n=e.querySelector(".singleimage img");t.querySelector(".jw-dialog-innner").appendChild(n.cloneNode(!0)),t.classList.add("open"),document.body.classList.add("jw-modal-open"),document.addEventListener("click",_closeModalHandler),document.addEventListener("keydown",(e=>{"Escape"===e.key&&_closeModalHandler(e)})),initGestures(document.querySelector("#dialog .jw-dialog-innner img"))}}function commentModal(e){if(document.body.offsetWidth<480)return;let t=document.querySelector("#dialog"),n=e.cloneNode(!0),o=t.querySelector(".jw-dialog-innner");n.style.maxWidth="none",o.querySelectorAll("img").forEach((e=>{o.removeChild(e)})),o.appendChild(n),t.classList.add("open"),document.body.classList.add("jw-modal-open"),document.addEventListener("click",_closeModalHandler),document.addEventListener("keydown",(e=>{"Escape"===e.key&&_closeModalHandler(e)})),initGestures(document.querySelector("#dialog .jw-dialog-innner img"))}function closeModal(){let e=document.getElementById("dialog");e.classList.remove("open"),document.body.classList.remove("jw-modal-open"),e.querySelector(".jw-dialog-innner").childNodes.forEach((e=>e.remove())),document.removeEventListener("click",_closeModalHandler)}export function postsLoadedCallback(e=!0){activatePost(!1),document.body.classList.contains("comments")&&activateComment()}function updateCurrentPostIdxOnScroll(){var e=!1;document.querySelectorAll(".post").forEach(((t,n)=>{!e&&t.offsetTop>window.scrollY&&(activePostIdx=n,activatePost(!1),e=!0)}))}export function setTitle(e){document.title=e+" • RDX"}export function collapseComment(e){let t,n,o=e,l=o,s=Math.abs(o.classList[1].replace("ccp",""));if("1"==o.getAttribute("iscollasped")){for(;t=l.nextSibling;){if(t.classList.contains("comment")){if(n=Math.abs(t.classList[1].replace("ccp","")),!(n>s))break;t.style.display="block",t.classList.remove("collapsed-hidden")}else t.style.display="block",t.classList.remove("collapsed-hidden");l=t}o.classList.toggle("collapsed"),o.setAttribute("iscollasped","0")}else{for(;t=l.nextSibling;){if(t.classList.contains("comment")){if(n=Math.abs(t.classList[1].replace("ccp","")),!(n>s))break;t.style.display="none",t.classList.add("collapsed-hidden")}else t.style.display="none",t.classList.add("collapsed-hidden");l=t}o.classList.toggle("collapsed"),o.setAttribute("iscollasped","1")}}let ticking=!1;document.addEventListener("scroll",(e=>{window.scrollY;ticking||(window.requestAnimationFrame((()=>{updateCurrentPostIdxOnScroll(),ticking=!1})),ticking=!0)})),addEventListener("DOMContentLoaded",(e=>{var t='<form class="search" action="search.html"><input type="search" name="q" value="'+(getget("q")?getget("q"):"")+'"/>';if(t+='<input type="submit" value="Search"/><br style="clear:both;">',(window.location.href.indexOf("?r=")>-1||window.location.href.indexOf("&r=")>-1)&&(t+='<input type="checkbox" id="chk1" name="r" value="'+getget("r")+'" checked><label for="chk1"> Only search r/'+getget("r")+"</label>"),(window.location.href.indexOf("?u=")>-1||window.location.href.indexOf("&u=")>-1)&&(t+='<input type="checkbox" id="chk1" name="u" value="'+getget("u")+'" checked><label for="chk1"> Only search u/'+getget("u")+"</label>"),window.location.href.indexOf("/r/")>-1){var n=window.location.href.match(/r\/(.*?)\//s)[1];t+='<input type="checkbox" id="chk1" name="r" value="'+n+'" checked><label for="chk1"> Only search r/'+n+"</label>"}t+="</form>",document.getElementById("leftbar").insertAdjacentHTML("afterBegin",t),document.addEventListener("click",(e=>{if(e.target.closest("a.lazy-video")&&e.target.closest("a").dataset.target){let t=e.target.closest("a");t.parentNode.style.height=t.offsetHeight+"px";let n=t.dataset.target,o=document.getElementById("vt-"+n).content.cloneNode(!0);t.classList.add("hidden"),t.parentNode.appendChild(o);let l=document.getElementById("v"+n);return l.classList.contains("reddit_hls")?runhsl_on_vid(l):l.play(),l.addEventListener("play",(e=>{window.setTimeout((()=>{setupPauseVideo(l)}),2e3)})),window.setTimeout((()=>{l.play(),l.addEventListener("pause",(e=>{setupUnloadVideo(l)}))}),400),e.preventDefault(),!1}if(e.target.closest(".postc.singleimage")){var t=e.target.closest(".postc.singleimage"),n=e.target.closest(".post");if(t.classList.contains("url"))return;postModal(n)}else if(e.target.closest(".comment-image")){commentModal(e.target.closest(".comment-image"))}})),document.addEventListener("keydown",(e=>{if(!document.querySelector("input:focus"))switch(e.key){case"j":case"J":case"ArrowDown":e.preventDefault(),document.body.classList.contains("comments")?nextComment():nextItem(!0);break;case"k":case"K":case"ArrowUp":e.preventDefault(),document.body.classList.contains("comments")?prevComment():prevItem(!0);break;case"Enter":case"ArrowRight":e.preventDefault(),document.body.classList.contains("comments")?openComment():openItem();break;case"Escape":if(document.body.classList.contains("jw-modal-open"))return;case"ArrowLeft":e.preventDefault(),document.body.classList.contains("comments")?collapseCurrentComment():closeModal()}})),document.getElementById("plus").addEventListener("click",(e=>{e.preventDefault(),toggle("leftbar")})),document.getElementById("taptoopenmenu").addEventListener("click",(e=>{e.preventDefault(),toggle("subssearch")})),document.getElementById("menu").addEventListener("click",(e=>{e.preventDefault(),toggle("rightbar")})),document.getElementById("subssearchi").addEventListener("keyup",(e=>{searchsubs(e.target.value,e)}));const o=document.getElementById("subbtn");o&&o.addEventListener("click",(e=>{e.preventDefault();var t=e.target.dataset.target;checklc("subs",t)?unsubscribe(t):subscribe(t)}))}));