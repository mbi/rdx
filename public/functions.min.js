var bmr="",seenPostIds=[],activePostIdx=0,activeCommentIdx=0,nexturl="",nextseturl="";if(null!==JSON.parse(localStorage.getItem("subs"))){for(x in subslisted="",subslistedarray=JSON.parse(localStorage.getItem("subs")),subslistedarray.sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())})),subslistedarray)subslisted+='<a href="subreddit.html?r='+subslistedarray[x]+'" class="homelinks">'+subslistedarray[x]+"</a>";document.getElementById("subscribed").innerHTML=subslisted}function toggletheme(){const e=localStorage.getItem("tname")||"default";"default"!=e&&"Default"!=e?(document.documentElement.style.setProperty("--bodyc",localStorage.getItem("bodyc")),document.documentElement.style.setProperty("--textc",localStorage.getItem("textc")),document.documentElement.style.setProperty("--linkc",localStorage.getItem("linkc")),document.documentElement.style.setProperty("--greyc",localStorage.getItem("greyc")),document.documentElement.style.setProperty("--lightc",localStorage.getItem("lightc"))):(document.documentElement.style.setProperty("--bodyc","white"),document.documentElement.style.setProperty("--textc","black"),document.documentElement.style.setProperty("--linkc","#27598c"),document.documentElement.style.setProperty("--greyc","#eee"),document.documentElement.style.setProperty("--lightc","#444"))}function togglefont(){const e=localStorage.getItem("fname")||"default";if("default"!=e){const t=document.createElement("link");t.rel="stylesheet",t.href="https://fonts.googleapis.com/css2?family="+e+"&display=swap",document.head.appendChild(t),document.body.style.fontFamily=e+", sans-serif"}}var curinfi=localStorage.getItem("curinfi")||!0;if(-1==window.location.href.indexOf("comments.html")&&curinfi){var style=document.createElement("style");style.innerHTML=".footer, .infotext, .next {display:none !important}",document.head.appendChild(style)}function toggle(e){var t=document.getElementsByClassName("show");for(k=0;k<t.length;k++)t[k].id!=e&&(t[k].classList.toggle("hidden"),t[k].classList.toggle("show"));document.getElementById(e).classList.toggle("hidden"),document.getElementById(e).classList.toggle("show"),"subssearch"==e&&document.getElementById("subssearchi").focus()}function makereq(e){var t,o="",n=new XMLHttpRequest;n.responseType="json",n.open("GET",e,!0),n.onload=function(){var r=n.response;console.log(e);var s=e.replace("https://www.reddit.com/r/","");for(var l in s=s.replace("/.json",""),posts=r.data.children.filter((e=>-1===seenPostIds.indexOf(e.id))),posts)t=posts[l].data,o+=postbuilder(t),seenPostIds.push(t.id);o+='<div class="navigate">';var i=window.location.href.replace(/\&after.*/,"");null!=r.data.after&&(-1===i.indexOf("?")&&(i+="?a=b"),o+='<a class="next" href="'+i+"&after="+r.data.after+'">Next page</a><div id="sxpy"></div><div id="sentinel"> </div>',nextseturl=i+"&after="+r.data.after,nexturl=e.split("&after")[0]+"&after="+r.data.after),o+="</div>",document.getElementById("body").innerHTML=o,runhsl(),curinfi&&observe(),postsLoadedCallback(!0)},n.onerror=function(){document.getElementById("body").innerHTML="<center style=\"padding:15px;\">Can't load content!<br><small>There can be multiple reasons for this, your browser's aggresive privacy settings may be blocking the one call to reddit.com RDX makes. This happens usually when you use a VPM/Proxy and/or a privacy focused browser like Firefox.<br> Play around with privacy/tracking options or change your browser. If it still doesn't work click the feedback link and send me some info.</small></center>"},n.send(null)}togglefont();var _is_requesting=!1;function scorllmore(){if(_is_requesting)return;var e;_is_requesting=!0;const t=nexturl;let o="";if(""==nexturl)return!1;console.log(nexturl);var n=new XMLHttpRequest;n.responseType="json",n.open("GET",t,!0),n.onload=function(){var r=n.response;for(var s in posts=r.data.children.filter((e=>-1===seenPostIds.indexOf(e.id))),posts)e=posts[s].data,o+=postbuilder(e),seenPostIds.push(e.id);var l=window.location.href.replace(/\&after.*/,"");null!=r.data.after?(-1===l.indexOf("?")&&(l+="?a=b"),history.pushState("","newtitle",nextseturl),nextseturl=l+"&after="+r.data.after,nexturl=(nexturl=t.split("&after")[0])+"&after="+r.data.after):nexturl="",document.getElementById("sxpy").insertAdjacentHTML("beforeend",o),document.getElementById("sentinel").innerHTML=" ",runhsl(),postsLoadedCallback(!1),_is_requesting=!1},n.onerror=function(){document.getElementById("sxpy").innerHTML+='<center style="padding:15px;">Can\'t load content! Refresh the page or try again later.</center>',nexturl="",_is_requesting=!1},n.send(null)}function observe(){cantload=!1;const e=new IntersectionObserver((function(e,t){e.forEach((e=>{e.isIntersecting&&0==cantload&&(document.getElementById("sentinel").innerHTML="<center>Loading more posts..</center>",cantload=!0,setTimeout((()=>{scorllmore(),cantload=!1}),100))}))}),{root:null,threshold:1}),t=document.getElementById("sentinel");t&&e.observe(t)}function htmlDecode(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent}function timeago(e){var t=Math.floor((new Date-e)/1e3),o=t/31536e3;return o>1?Math.floor(o)+"y":(o=t/2592e3)>1?Math.floor(o)+"mo":(o=t/86400)>1?Math.floor(o)+"d":(o=t/3600)>1?Math.floor(o)+"h":(o=t/60)>1?Math.floor(o)+"m":Math.floor(t)+"s"}function addlc(e,t){addarr=JSON.parse(localStorage.getItem(e)||"[]"),addarr.push(t),localStorage.setItem(e,JSON.stringify(addarr))}function checklc(e,t){return chkarr=JSON.parse(localStorage.getItem(e)||"[]"),chkarr.includes(t)}function removelc(e,t){addarr=JSON.parse(localStorage.getItem(e)||"[]"),addarr=addarr.filter((function(e){return e!==t})),localStorage.setItem(e,JSON.stringify(addarr))}function searchsubs(e,t){bmr&&bmr.abort();var o=new XMLHttpRequest;(bmr=o,o.onreadystatechange=function(){if(4===o.readyState&&200==o.status){for(var e in subslist=o.response,fillsubs="",subslist.subreddits)fillsubs+='<a href="subreddit.html?r='+subslist.subreddits[e].name+'">'+subslist.subreddits[e].name+"</a>";document.getElementById("subslist").innerHTML=fillsubs}},o.responseType="json",o.open("GET","https://www.reddit.com//api/subreddit_autocomplete/.json?query="+e+"&include_profiles=false&include_over_18=true",!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(),e.length>1)&&(13==(t.keyCode||t.charCode)&&void 0!==typeof subslist.subreddits&&(window.location="subreddit.html?r="+subslist.subreddits[0].name))}function unsubscribe(e){removelc("subs",e),subbtn=document.getElementById("subbtn"),subbtn.setAttribute("onclick","subscribe('"+e+"')"),subbtn.innerHTML="Subscribe"}function subscribe(e){addlc("subs",e),subbtn=document.getElementById("subbtn"),subbtn.setAttribute("onclick","unsubscribe('"+e+"')"),subbtn.innerHTML="Unsubscribe"}function replaceRedditLinks(e){return e.replace(/href="\/u\/([^"]+)"/g,'href="user.html?u=$1"').replace(/href="\/r\/([^"]+)"/g,'href="subreddit.html?r=$1"').replace(/(href=\"https:\/\/(old.|www.|)reddit\.com\/r\/[^\/]+\/comments\/[^"]+)(\?[^"]+)?/g,(function(e,t,o){return'class="comment-icon icon" href="comments.html?url='+encodeURIComponent(t).replace(/href%3D%22/g,"")})).replace(/(href=\"https:\/\/reddit\.com\/r\/[^\/]+\/comments\/[^"]+)(\?[^"]+)?/g,(function(e,t,o){return'class="comment-icon icon" comments.html?url='+encodeURIComponent(t+(o||""))}))}function postbuilder(e){returnfpost="";let t=localStorage.getItem("curmode")||"original";if(-1!=window.location.href.indexOf("comments.html")&&(t="original"),timeagoed=timeago(1e3*e.created_utc),sticky=e.stickied?" sticky":" ",over18="",1!=checklc("a18","yes")&&(over18=e.over_18?"over18":" "),ismod="moderator"==e.distinguished?" moderator":" ",returnfpost+='<div class="post '+t+'" id="'+e.id+'">',"comp"==t)if(thumbnail=e.thumbnail,"self"!=thumbnail&&"spoiler"!=thumbnail&&"default"!=thumbnail&&""!=thumbnail&&"nsfw"!=thumbnail)"image"==thumbnail&&(thumbnail=e.preview.images[0].resolutions[0].url),returnfpost+='<div class="compthumb"><img src="'+thumbnail+'" alt="thumbnail"/></div><div class="rop">';else{thumbnail=thumbnail||"&bull;";const t=e?.preview?.images?.[0]?.resolutions?.[0]?.url||"none";returnfpost+="none"!=t?'<div class="compthumb"><img src="'+t+'" alt="thumbnail"/></div><div class="rop">':'<div class="comptext">'+thumbnail+'</div><div class="rop">'}if(returnfpost+='<div class="post_link'+sticky+" "+ismod+'"><a href="comments.html?url=https://www.reddit.com'+e.permalink+'">'+e.title+"</a></div>","comp"!=t){if(null!=e.selftext_html){var o=replaceRedditLinks(e.selftext_html);returnfpost+='<div class="postc selftext"><overflow-toggle show="+" hide="">'+htmlDecode(o)+"</overflow-toggle></div>"}urli=e.url_overridden_by_dest,null!=e.crosspost_parent_list&&e.crosspost_parent_list.length>0||void 0!==e.crosspost_parent_list&&e.crosspost_parent_list.length>0?returnfpost+=postbuilder(e.crosspost_parent_list[0]):("undefined"!=typeof urli&&null==e.removed_by_category&&(returnfpost+='<div class="urlpreview '+over18+'">'+urlpreview(urli,e)+'</div><div style="text-align: right;font-size:12px;"><a href="'+e.url+'"><small>Open URL</small></a></div>'),null!=e.removed_by_category&&(returnfpost+="Removed by "+e.removed_by_category),null!=e.poll_data&&(returnfpost+=pollbuilder(e)))}return returnfpost=returnfpost+'<div class="post_meta"><div class="flex-left"><a class="comments-icon icon" href="comments.html?url=https://www.reddit.com'+e.permalink+'">'+e.num_comments+'</a><span class="upvotes-icon icon">'+e.score+'</span><a class="ext-url-icon icon" href="'+e.url+'"></a>',returnfpost+='</div><div class="post_author flex-right"><a href="subreddit.html?r='+e.subreddit+'">'+e.subreddit_name_prefixed+'</a> <a class="small-hidden" href="user.html?u='+e.author+'">'+e.author+"</a> "+timeagoed+"</div>",null!==localStorage.getItem("refreshToken")&&window.location.href.includes("comments.html")&&(returnfpost+=" &bull; <span onclick=\"replyto('t3_"+e.id+"')\">Reply</span>"),returnfpost+="</div>","comp"==t&&(returnfpost+="</div>"),returnfpost+="</div>",returnfpost}function allown_sfw(){addlc("a18","yes"),window.location.reload()}function preloadImage(e){let t=document.createElement("div");t.innerHTML=`<img src="${e}" />`,document.body.appendChild(t),setTimeout((function(){document.body.removeChild(t)}),1)}function closegal(){document.getElementById("newgallery").outerHTML=""}function galleryopen(e){const t=document.createElement("div");t.id="newgallery",document.getElementsByTagName("body")[0].appendChild(t),t.innerHTML='<span id="closegal" onclick="closegal();">Close</span>',document.querySelectorAll('[data-id="'+e+'"]').forEach((e=>{t.innerHTML+='<div class="displayimg"><img src="'+e.getAttribute("data-msrc")+'"></div>'}))}function previewImage(e){var t;try{var o=e.preview.images[0].resolutions[0];e.preview.images[0].resolutions.forEach((e=>{e.width&&e.width>=o.width&&e.width<=640&&(o=e)})),t=o.url}catch(o){t=e.thumbnail}return"default"===t&&(t=""),t}function urlpreview(e,t){if(returnpost="",e.match(/.(jpg|jpeg|png)$/i))returnpost+='<div class="postc singleimage"><img src="'+e+'"/></div>';else if(e.match(/.(gif)$/i)){const n=t?.preview?.images?.[0]?.variants?.mp4?.source?.url||"none";if("none"==n)returnpost+='<div class="postc singleimage"><img src="'+e+'"/></div>';else{vidposter=t.preview,"undefined"==typeof vidposter?vidposter=t.thumbnail:vidposter=t.preview.images[0].source.url;var o=previewImage(t);returnpost+='<div class="postc video generic-gif">',returnpost+='<a href="#" data-target="'+t.id+'" class="lazy-video imgur-com">',returnpost+='<img  loading="lazy" src="'+o+'#t=0.001"/>',returnpost+="</a>",returnpost+='<template id="vt-'+t.id+'">',returnpost+='<video id="v'+t.id+'" src="'+n+'#t=0.001" poster="'+o+'" width="100%" preload="none" loop controls>',returnpost+="</video>",returnpost+="</template>",returnpost+="</div>"}}else if(e.match(/www.reddit.com\/gallery/g)){returnpost+='<div class="postc gallery">',pjmd=t.media_metadata,pjgd=t.gallery_data;const e={};pjgd&&pjgd.items.forEach(((t,o)=>{const n=t.media_id;pjmd.hasOwnProperty(n)&&(e[n]=pjmd[n])}));let o=" actv";for(var n in returnpost+='<slide-show controls="pagination navigation" loop>',e)"failed"!=e[n].status&&(singleptlink=e[n].s.u,"undefined"==typeof singleptlink?singleptlink=e[n].s.gif:singleptlink=singleptlink.replace("preivew.redd","i.redd"),singletmlink=e[n].p[0].u,returnpost+='<img style="width:100%;height:auto" draggable="false" src="'+singleptlink+'" />'),o="";returnpost+="</slide-show>",returnpost+="</div>"}else if(e.match(/v.redd.it/g)){if(returnpost+='<div class="postc video vreddit">',null!=t.secure_media)vidurl=t.secure_media.reddit_video.dash_url,hlsurl=t.secure_media.reddit_video.hls_url,fallbackurl=t.secure_media.reddit_video.fallback_url,vidposter=t.preview,"undefined"==typeof vidposter?vidposter=t.thumbnail:vidposter=t.preview.images[0].source.url,(o=previewImage(t))?(returnpost+='<a href="#" data-target="'+t.id+'" class="lazy-video">',returnpost+='<img loading="lazy" src="'+o+'#t=0.001"/>',returnpost+="</a>",returnpost+='<template id="vt-'+t.id+'">',returnpost+='<video id="v'+t.id+'" src="'+vidurl+'#t=0.001" data-fallback="'+fallbackurl+'" data-hls="'+hlsurl+'" poster="'+vidposter+'" width="100%" preload="metadata" class="reddit_hls"  controls>',returnpost+="</video>",returnpost+="</template>"):(returnpost+='<video id="v'+t.id+'" src="'+vidurl+'#t=0.001" data-fallback="'+fallbackurl+'" data-hls="'+hlsurl+'" poster="'+vidposter+'" width="100%" preload="metadata" class="reddit_hls"  controls>',returnpost+="</video>");else returnpost+="crosspost";returnpost+="</div>"}else if(e.match(/redgifs/g)&&t.preview){if(returnpost+='<div class="postc video redgifs">',t.secure_media)if(vidurl=t.secure_media.oembed.thumbnail_url,"undefined"==typeof vidurl)vidurl=e.replace("redgifs.com/watch/","redgifs.com/ifr/"),vidurl='<iframe src="'+vidurl+'?autoplay=0" class="gifframe"></iframe>',returnpost+=vidurl;else{t.preview&&void 0!==t.preview.reddit_video_preview?vidurl=t.preview.reddit_video_preview.fallback_url:t.secure_media.oembed.thumbnail_url&&(vidurl=t.secure_media.oembed.thumbnail_url),vidurl=vidurl.replace("size_restricted.gif","mobile.mp4");o=previewImage(t);returnpost+='<a href="#" data-target="'+t.id+'" class="lazy-video">',returnpost+='<img  loading="lazy" src="'+o+'#t=0.001"/>',returnpost+="</a>",returnpost+='<template id="vt-'+t.id+'">',returnpost+='<video id="v'+t.id+'" src="'+vidurl+'" poster="'+o+'" width="100%" preload="metadata" controls>',returnpost+="</video>",returnpost+="</template>"}returnpost+="</div>"}else if(e.match(/gfycat.com/g))returnpost+='<div class="postc video gyfcat">',null==t.secure_media||void 0===t.secure_media.oembed.thumbnail_url?(vidurl=e.replace("gfycat.com/","gfycat.com/ifr/"),vidurl='<iframe src="'+vidurl+'?autoplay=0" class="gifframe"></iframe>',returnpost+=vidurl):(void 0!==t.preview.reddit_video_preview?vidurl=t.preview.reddit_video_preview.fallback_url:t.secure_media.oembed.thumbnail_url&&(vidurl=t.secure_media.oembed.thumbnail_url),vidurl=vidurl.replace("size_restricted.gif","mobile.mp4"),returnpost+='<video src="'+vidurl+'" poster="'+t.thumbnail+'" width="100%" height="240" preload="metadata" controls> </video>'),returnpost+="</div>";else if(e.match(/i.imgur.com(.*?)gifv/g)){returnpost+='<div class="postc video imgur">';let n=e.replace(".gifv",".mp4");o=previewImage(t);returnpost+='<a href="#" data-target="'+t.id+'" class="lazy-video">',returnpost+='<img  loading="lazy" src="'+o+'#t=0.001"/>',returnpost+="</a>",returnpost+='<template id="vt-'+t.id+'">',returnpost+='<video  id="v'+t.id+'" src="'+n+'" poster="'+o+'#t=0.001" width="100%" preload="none" controls class="lazy">',returnpost+="</video>",returnpost+="</template>",returnpost+="</div>"}else thumbnailforit=previewImage(t)||"",thumbnailforit?(returnpost+='<a href="'+e+'" class="postc singleimage url">',returnpost+='<img src="'+thumbnailforit+'"/>',returnpost+="</a>"):returnpost+='<div class="postc link"><a href="'+e+'" >'+thumbnailforit+e+"</a></div>",returnpost=replaceRedditLinks(returnpost);return returnpost}function pollbuilder(e){for(popt in returnpoll='<div class="poll">',e.poll_data.options)vote_count=e.poll_data.options[popt].vote_count,"undefined"==typeof vote_count&&(vote_count=" "),returnpoll+='<div class="polloption"><span class="polloptiontext">'+e.poll_data.options[popt].text+'</span> <span  class="votecount">'+vote_count+"</span>"," "!=vote_count&&(returnpoll+='<div class="optionmeter" style="width:'+e.poll_data.options[popt].vote_count/e.poll_data.total_vote_count*100+'%;"></div>'),returnpoll+="</div>";return returnpoll+='<div class="totalvotes">Total votes: '+e.poll_data.total_vote_count+"</div>",returnpoll+="</div>",returnpoll}function playaud(e){document.getElementById(e).play()}function pauseaud(e){document.getElementById(e).pause()}function seeked(e){document.getElementById("a"+e).currentTime=document.getElementById("v"+e).currentTime}function getget(e,t=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");var o=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}function cbuilder(e){return timeagoed=timeago(1e3*e.created_utc),isop=1==e.is_submitter?"isop":"",ismod=" moderator"==e.distinguished?"ismod":"",cret='<div class="comment ccp'+e.depth+("AutoModerator"===e.author?" collapsed":"")+'" id="'+e.id+'"><div class="comment_author"><span class="authorttext '+isop+ismod+'"><a class="authorlink" href="user.html?u='+e.author+'">'+e.author+'</a></span>  <span class="comment_meta upvotes-icon icon">'+e.score+" &bull; "+timeagoed+' </span></div><div class="comment_text">'+replaceRedditLinks(htmlDecode(e.body_html))+"</div>",null!=localStorage.getItem("refreshToken")&&(cret+='<div class="comment-reply"><span onclick="replyto(\'t1_'+e.id+"')\">Reply</span>",localStorage.getItem("userName")==e.author&&(cret+="<span onclick=\"editto('t1_"+e.id+"')\">Edit</span><span onclick=\"deleteto('t1_"+e.id+"')\">Delete</span>"),cret+="</div>"),cret+="</div>",cret}function runhsl_on_vid(e){e.parentElement;e.classList.add("goner");if(/iPhone|iPad/i.test(navigator.userAgent))e.src=e.getAttribute("data-hls");else{dashjs.MediaPlayer().create().initialize(e,e.src,!0)}}function runhsl(){document.querySelectorAll(".reddit_hls:not(.goner)").forEach((e=>{e.parentElement;e.classList.add("goner");if(/iPhone|iPad/i.test(navigator.userAgent))e.src=e.getAttribute("data-hls");else{dashjs.MediaPlayer().create().initialize(e,e.src,!1)}}));document.querySelectorAll(".gtumb").forEach((e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-id");document.getElementById("mi_"+e).src=this.getAttribute("data-msrc"),document.querySelectorAll('[data-id="'+e+'"]').forEach((e=>e.classList.remove("actv"))),this.classList.add("actv"),document.getElementById("mi_"+e).scrollIntoView()}))}))}function shareit(){if(navigator.share){const e=window.location.href,t={title:document.title,url:e};navigator.share(t).then((()=>{console.log("Shared successfully")})).catch((e=>{console.error("Error sharing:",e)}))}else{const e=window.location.href,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),alert("Link copied to clipboard: "+e)}}function saveit(e){if("Saved"==e.innerHTML)return window.location.href="saved.html",!1;const t=window.location.href,o=document.title,n=document.querySelector(".post_author a").innerText,r=JSON.parse(localStorage.getItem("savedlinks"))||[];r.push({u:t,t:o,s:n}),localStorage.setItem("savedlinks",JSON.stringify(r)),e.innerHTML="Saved"}function displayit(){const e=JSON.parse(localStorage.getItem("savedlinks"))||[],t=document.getElementById("links-container");t.innerHTML="";for(let o=e.length-1;o>=0;o--){const n=e[o],r=document.createElement("div");r.className="post",r.innerHTML='<div class="post_author"><a href="subreddit.html?r='+n.s.replace("r/","")+'">'+n.s+'</a> <span onclick="removeit('+o+');" style="float:right;color: var(--lightc);">X</span> </div><div class="post_link"><a href="'+n.u+'">'+n.t+"</a></div>",t.appendChild(r)}}function removeit(e){const t=JSON.parse(localStorage.getItem("savedlinks"))||[];e>=0&&e<t.length&&(t.splice(e,1),localStorage.setItem("savedlinks",JSON.stringify(t)),displayit())}function replyto(e){document.getElementById("popitup").style.display="block",document.getElementById("cmtid").value=e,document.getElementById("actype").value="c";let t=e.replace(/^(t1_|t3_)/,"");"post"!=document.getElementById(t).className?document.getElementById("helptext").textContent="Reply to: "+document.getElementById(t).querySelector(".comment_text").textContent:document.getElementById("helptext").textContent="Reply to:"+document.getElementById(t).querySelector(".post_link a").textContent,document.getElementById("commentText").focus()}function editto(e){document.getElementById("popitup").style.display="block",document.getElementById("cmtid").value=e;let t=e.replace(/^(t1_|t3_)/,"");document.getElementById("commentText").value=document.getElementById(t).querySelector(".comment_text").textContent,document.getElementById("actype").value="e",document.getElementById("helptext").textContent="Editing: "+document.getElementById(t).querySelector(".comment_text").textContent,document.getElementById("commentText").focus()}function deleteto(e){confirm("Are you sure you want to delete this?")&&(document.getElementById("cmtid").value=e,document.getElementById("actype").value="d",apiAction())}function inboxto(){document.getElementById("actype").value="i",apiAction()}function apiAction(){const e=localStorage.getItem("accessToken"),t=localStorage.getItem("expiresIn"),o=localStorage.getItem("refreshToken"),n=localStorage.getItem("clientId"),r=localStorage.getItem("clientSecret"),s=document.getElementById("actype").value;if(e&&t){const l=Date.now(),i=parseInt(t);if(l<i)"c"==s?submitComment(e):"e"==s?editComment(e):"d"==s?delComment(e):"i"==s&&getInbox(e);else{fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${btoa(`${n}:${r}`)}`},body:`grant_type=refresh_token&refresh_token=${o}`}).then((e=>e.json())).then((t=>{const o=t.access_token,n=t.refresh_token,r=t.expires_in,i=l+1e3*r;localStorage.setItem("accessToken",o),localStorage.setItem("refreshToken",n),localStorage.setItem("expiresIn",i.toString()),"c"==s?submitComment(e):"e"==s?editComment(e):"d"==s?delComment(e):"i"==s&&getInbox(e)})).catch((e=>{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",alert("Error refreshing token:",e)}))}}else window.location.href="login.html"}function submitComment(e){document.getElementById("cmntbtn").disabled=!0,document.getElementById("cmntbtn").innerHTML="Submitting...";const t=document.getElementById("cmtid").value,o=document.getElementById("commentText").value;fetch("https://oauth.reddit.com/api/comment",{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"},body:`api_type=json&text=${encodeURIComponent(o)}&thing_id=${t}`}).then((e=>e.json())).then((e=>{if(e.errors&&e.errors.length>0)document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",alert("Error submitting comment:"+e.errors);else{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",document.getElementById("popitup").style.display="none",document.getElementById("commentText").value="";let e=t.replace(/^(t1_|t3_)/,""),n="ccp0";if("post"!=document.getElementById(e).className){let t=document.getElementById(e).className.match(/ccp\d+/)[0].replace("ccp","");t=Math.floor(t)+1,n="ccp"+t}document.getElementById(e).insertAdjacentHTML("afterEnd",'<div class="comment '+n+'"><div class="comment_author"><span class="authorttext ">You</span>  <span class="comment_meta">1 votes • Just now </span></div><div class="comment_text">'+o+"</div></div>")}})).catch((e=>{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").value="Submit",alert("Error submitting comment:"+e)}))}function editComment(e){document.getElementById("cmntbtn").disabled=!0,document.getElementById("cmntbtn").innerHTML="Submitting...";const t=document.getElementById("cmtid").value,o=document.getElementById("commentText").value;fetch("https://oauth.reddit.com/api/editusertext",{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"},body:`api_type=json&text=${encodeURIComponent(o)}&thing_id=${t}`}).then((e=>e.json())).then((e=>{if(e.errors&&e.errors.length>0)document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",alert("Error editing comment:"+e.errors);else{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").value="Submit",document.getElementById("popitup").style.display="none",document.getElementById("commentText").value="";let e=t.replace(/^(t1_|t3_)/,"");document.getElementById(e).querySelector(".comment_text").textContent=o}})).catch((e=>{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",alert("Error editing comment:"+e)}))}function delComment(e){const t=document.getElementById("cmtid").value;fetch("https://oauth.reddit.com/api/del",{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"},body:`id=${t}`}).then((e=>e.json())).then((e=>{if(e.errors&&e.errors.length>0)alert("Error deleting comment:"+e.errors);else{let e=t.replace(/^(t1_|t3_)/,"");document.getElementById(e).style.display="none"}})).catch((e=>{alert("Error deleting comment:"+e)}))}function getInbox(e){fetch("https://oauth.reddit.com/message/inbox",{method:"GET",headers:{Authorization:`Bearer ${e}`}}).then((e=>e.json())).then((e=>{if(e.error)console.error("Error fetching inbox messages:",e.error);else{const t=e.data.children;console.log(t);let o="";t.forEach((e=>{const{kind:t,inboxMessages:{author:n,created_utc:r,subject:s,link_title:l,body_html:i,tname:a,context:d}}=e,c=new Date(1e3*r),u=`${c.getDate()}/${c.getMonth()+1}/${c.getFullYear()} - ${c.getHours()}:${c.getMinutes()}`;"t1"===t?(o+=`<div class="inboxmsgwrap"><div class="ibxmeta"><span class="ibxauthor"><a href="user.html?u=${n}">u/${n}</a> &bull;  <span class="ibxtime">${u}</span></span></div>`,o+=`<div class="ibxsub">${s}</div>`,o+=`<div class="ibxlink"><a href="comments.html?url=https://www.reddit.com${d}">${l}</a></div>`,o+=`<div class="ibxmsg">${i}</div>`,o+=`<div class="ibxactions"><button onclick="replyto('${a}')">Reply</button></div></div>`):"t4"===t&&(o+=`<div class="inboxmsgwrap"><div class="ibxmeta"><span class="ibxauthor"><a href="user.html?u=${n}">u/${n}</a> &bull;  <span class="ibxtime">${u}</span></span></div>`,o+=`<div class="ibxsub">${s}</div>`,o+=`<div class="ibxmsg">${i}</div></div>`,o+=`<div class="ibxactions"><button onclick="replyto('${a}')">Reply</button></div></div>`)})),document.getElementById("inboxbody").innerHTML=o}})).catch((e=>{console.error("Error fetching inbox messages:",e)}))}function setupUnloadVideo(e){const t=new IntersectionObserver((t=>{if(console.log("setupUnloadVideo",e.id,t[0].intersectionRatio),t[0].intersectionRatio<=0){console.log("Unloading",e.id);let t=e.parentNode.querySelector(".lazy-video.hidden");t&&(t.classList.remove("hidden"),e.remove())}}));setTimeout((()=>{console.log("setupUnloadVideo",e.id),t.observe(e)}),1e3)}function setupPauseVideo(e){new IntersectionObserver((t=>{console.log("setupPauseVideo",e.id,t[0].intersectionRatio),t[0].intersectionRatio<=0&&(console.log("Pausing",e.id,e),e.pause())})).observe(e)}function nextItem(e=!1){++activePostIdx>document.querySelectorAll(".post").length-1&&(activePostIdx=document.querySelectorAll(".post").length-1),activatePost(e)}function nextComment(){for(var e=document.querySelectorAll(".comment"),t=activeCommentIdx+1;t<e.length;t++)if(!e[t].classList.contains("collapsed-hidden")){activeCommentIdx=t;break}activateComment(!0)}function prevItem(e=!1){--activePostIdx<0&&(activePostIdx=0),activatePost(e)}function prevComment(){for(var e=document.querySelectorAll(".comment"),t=activeCommentIdx-1;t>=0;t--)if(!e[t].classList.contains("collapsed-hidden")){activeCommentIdx=t;break}activateComment(!0)}function openComment(){var e=document.querySelector(".current-comment");e&&collapse(e)}function collapseComment(){var e=document.querySelector(".current-comment");e&&collapse(e)}function openItem(){var e=document.querySelector(".current-post");e&&(e.querySelector("a.lazy-video")?e.querySelector("a.lazy-video").click():e.querySelector(".singleimage.url")?window.location.href=e.querySelector(".singleimage.url").href:e.querySelector(".singleimage img")&&(document.body.classList.contains("jw-modal-open")?closeModal():postModal(e)))}function activateComment(e=!1){var t=document.querySelector(".current-comment");t&&t.classList.remove("current-comment"),document.querySelector(".comment")&&(t=document.querySelectorAll(".comment")[activeCommentIdx]).classList.add("current-comment")}function activatePost(e=!1){var t=document.querySelector(".current-post");t&&t.classList.remove("current-post"),document.querySelector(".post")&&(t=document.querySelectorAll(".post")[activePostIdx]).classList.add("current-post"),e&&t&&window.scrollTo({top:t.offsetTop-46,behavior:"smooth"})}const _closeModalHandler=function(e){if(document.body.classList.contains("jw-modal-open"))return closeModal(),e.preventDefault(),!1};function postModal(e){if(document.body.offsetWidth<480)return;let t=document.getElementById("dialog");if(e.querySelector(".singleimage img")){var o=e.querySelector(".singleimage img");t.querySelector(".jw-dialog-innner").appendChild(o.cloneNode(!0)),t.classList.add("open"),document.body.classList.add("jw-modal-open"),document.addEventListener("click",_closeModalHandler)}}function closeModal(){let e=document.getElementById("dialog");e.classList.remove("open"),document.body.classList.remove("jw-modal-open"),e.querySelector(".jw-dialog-innner").childNodes.forEach((e=>e.remove())),document.removeEventListener("click",_closeModalHandler)}function postsLoadedCallback(e=!0){console.log("postsLoadedCallback",e),activatePost(!1),document.body.classList.contains("comments")&&activateComment()}function updateCurrentPostIdxOnScroll(){var e=!1;document.querySelectorAll(".post").forEach(((t,o)=>{!e&&t.offsetTop>window.scrollY&&(activePostIdx=o,activatePost(!1),e=!0)}))}function setTitle(e){document.title=e+" • RDX"}let ticking=!1;document.addEventListener("scroll",(e=>{lastKnownScrollPosition=window.scrollY,ticking||(window.requestAnimationFrame((()=>{updateCurrentPostIdxOnScroll(),ticking=!1})),ticking=!0)})),window.onload=function(){if(curq=getget("q")?getget("q"):"",html1='<form class="search" action="search.html"><input type="search" name="q" value="'+curq+'"/>',html1+='<input type="submit" value="Search"/><br style="clear:both;">',(window.location.href.indexOf("?r=")>-1||window.location.href.indexOf("&r=")>-1)&&(html1+='<input type="checkbox" id="chk1" name="r" value="'+getget("r")+'" checked><label for="chk1"> Only search r/'+getget("r")+"</label>"),(window.location.href.indexOf("?u=")>-1||window.location.href.indexOf("&u=")>-1)&&(html1+='<input type="checkbox" id="chk1" name="u" value="'+getget("u")+'" checked><label for="chk1"> Only search u/'+getget("u")+"</label>"),window.location.href.indexOf("/r/")>-1&&(ther=window.location.href.match(/r\/(.*?)\//s)[1],html1+='<input type="checkbox" id="chk1" name="r" value="'+ther+'" checked><label for="chk1"> Only search r/'+ther+"</label>"),html1+="</form>",null!==localStorage.getItem("refreshToken")){const e=localStorage.getItem("userName");html1+='<a href="user.html?u=+'+e+'" class="homelinks">'+e+"</a>",html1+='<a href="inbox.html" class="homelinks half">Inbox</a>',html1+='<a href="login.html" class="homelinks half">Logout</a>'}document.getElementById("leftbar").insertAdjacentHTML("afterBegin",html1),document.addEventListener("click",(e=>{if(e.target.closest("a.lazy-video")&&e.target.closest("a").dataset.target){let t=e.target.closest("a");t.parentNode.style.height=t.offsetHeight+"px";let o=t.dataset.target,n=document.getElementById("vt-"+o).content.cloneNode(!0);t.classList.add("hidden"),t.parentNode.appendChild(n);let r=document.getElementById("v"+o);return r.classList.contains("reddit_hls")?runhsl_on_vid(r):r.play(),r.addEventListener("play",(e=>{window.setTimeout((()=>{setupPauseVideo(r)}),2e3)})),window.setTimeout((()=>{r.play(),r.addEventListener("pause",(e=>{setupUnloadVideo(r)}))}),400),e.preventDefault(),!1}if(e.target.closest(".postc.singleimage")){var t=e.target.closest(".postc.singleimage"),o=e.target.closest(".post");if(t.classList.contains("url"))return;postModal(o)}})),document.addEventListener("keydown",(e=>{if(!document.querySelector("input:focus"))switch(e.key){case"j":case"J":case"ArrowDown":e.preventDefault(),document.body.classList.contains("comments")?nextComment():nextItem(!0);break;case"k":case"K":case"ArrowUp":e.preventDefault(),document.body.classList.contains("comments")?prevComment():prevItem(!0);break;case"Enter":case"ArrowRight":e.preventDefault(),document.body.classList.contains("comments")?openComment():openItem();break;case"Escape":case"ArrowLeft":e.preventDefault(),document.body.classList.contains("comments")?collapseComment():closeModal()}}))};