import{timeago}from"./utils.min.js";import{replaceRedditLinks,htmlDecode}from"./html.min.js";import{okzoomer,gestureToMatrix,getOrigin,applyMatrix}from"./ok-gesture.min.js";var bmr="",seenPostIds=[],activePostIdx=0,activeCommentIdx=0,nexturl="",nextseturl="",selectedSeachResult=null;if(null!==JSON.parse(localStorage.getItem("subs"))){var subslisted="",subslistedarray=JSON.parse(localStorage.getItem("subs"));for(var x in subslistedarray.sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())})),subslistedarray)subslisted+='<a href="subreddit.html?r='+subslistedarray[x]+'" class="homelinks">'+subslistedarray[x]+"</a>";document.getElementById("subscribed").innerHTML=subslisted}var curinfi=localStorage.getItem("curinfi")||!0;if(-1==window.location.href.indexOf("comments.html")&&curinfi){var style=document.createElement("style");style.innerHTML=".footer, .infotext, .next {display:none !important}",document.head.appendChild(style)}export function toggle(e){for(var t=document.getElementsByClassName("show"),o=0;o<t.length;o++)t[o].id!=e&&(t[o].classList.toggle("hidden"),t[o].classList.toggle("show"));document.getElementById(e).classList.toggle("hidden"),document.getElementById(e).classList.toggle("show"),"subssearch"===e&&document.getElementById("subssearchi").focus()}export function makereq(e){e=e.replace(/www.reddit.com/g,"old.reddit.com");var t,o="",n=new XMLHttpRequest;n.responseType="json",n.open("GET",e,!0),n.onload=function(){var l=n.response,s=e.replace("https://old.reddit.com/r/","");s=s.replace("/.json","");var i=l.data.children.filter((e=>-1===seenPostIds.indexOf(e.id)));for(var a in i)t=i[a].data,o+=postbuilder(t),seenPostIds.push(t.id);o+='<div class="navigate">';var r=window.location.href.replace(/\&after.*/,"");null!=l.data.after&&(-1===r.indexOf("?")&&(r+="?a=b"),o+='<a class="next" href="'+r+"&after="+l.data.after+'">Next page</a><div id="sxpy"></div><div id="sentinel"> </div>',nextseturl=r+"&after="+l.data.after,nexturl=e.split("&after")[0]+"&after="+l.data.after),o+="</div>",document.getElementById("body").innerHTML=o,runhsl(),curinfi&&observe(),postsLoadedCallback(!0)},n.onerror=function(e){document.getElementById("body").innerHTML="<center style=\"padding:15px;\">Can't load content!<br><small>There can be multiple reasons for this, your browser's aggresive privacy settings may be blocking the one call to reddit.com RDX makes. This happens usually when you use a VPM/Proxy and/or a privacy focused browser like Firefox.<br> Play around with privacy/tracking options or change your browser. If it still doesn't work click the feedback link and send me some info.</small></center>",document.getElementById("body").innerHTML+='<code style="padding:15px; margin-top: 1rem; border: 1px solid>'+e.target.status+"</code>"},n.send(null)}var _is_requesting=!1;function scrollMore(){if(_is_requesting)return;var t;_is_requesting=!0;const o=nexturl.replace(/www.reddit.com/g,"old.reddit.com");let n="";if(""==nexturl)return!1;console.log(nexturl);var l=new XMLHttpRequest;l.responseType="json",l.open("GET",o,!0),l.onload=function(){var e=l.response,s=e.data.children.filter((e=>-1===seenPostIds.indexOf(e.id)));for(var i in s)t=s[i].data,n+=postbuilder(t),seenPostIds.push(t.id);var a=window.location.href.replace(/\&after.*/,"");null!=e.data.after?(-1===a.indexOf("?")&&(a+="?a=b"),history.pushState("","newtitle",nextseturl),nextseturl=a+"&after="+e.data.after,nexturl=(nexturl=o.split("&after")[0])+"&after="+e.data.after):nexturl="",document.getElementById("sxpy").insertAdjacentHTML("beforeend",n),document.getElementById("sentinel").innerHTML=" ",runhsl(),postsLoadedCallback(!1),_is_requesting=!1},l.onerror=function(){document.getElementById("sxpy").innerHTML+='<center style="padding:15px;">Can\'t load content! Refresh the page or try again later.</center>',document.getElementById("body").innerHTML+='<code style="padding:15px; margin-top: 1rem; border: 1px solid>'+e.target.status+"</code>",nexturl="",_is_requesting=!1},l.send(null)}function observe(){var e=!1;const t=new IntersectionObserver((function(t,o){t.forEach((t=>{t.isIntersecting&&0==e&&(document.getElementById("sentinel").innerHTML="<center>Loading more posts..</center>",e=!0,setTimeout((()=>{scrollMore(),e=!1}),100))}))}),{root:null,threshold:1}),o=document.getElementById("sentinel");o&&t.observe(o)}function addlc(e,t){var o=JSON.parse(localStorage.getItem(e)||"[]");o.push(t),localStorage.setItem(e,JSON.stringify(o))}export function checklc(e,t){return JSON.parse(localStorage.getItem(e)||"[]").includes(t)}function removelc(e,t){var o=JSON.parse(localStorage.getItem(e)||"[]");o=o.filter((function(e){return e!==t})),localStorage.setItem(e,JSON.stringify(o))}function searchsubs(e,t){bmr&&bmr.abort();var o=t.keyCode||t.charCode;let n=document.getElementById("subslist");if(38!==o&&40!==o){var l=new XMLHttpRequest;bmr=l,l.onreadystatechange=function(){if(4===l.readyState&&200==l.status){var e=l.response,t="";for(var o in e.subreddits)t+='<a href="subreddit.html?r='+e.subreddits[o].name+'">'+e.subreddits[o].name+"</a>";n.innerHTML=t,selectedSeachResult=null}},l.responseType="json",l.open("GET","https://old.reddit.com//api/subreddit_autocomplete/.json?query="+e+"&include_profiles=false&include_over_18=true",!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.send()}if(e.length>1)if(13===o)window.location="subreddit.html?r="+document.getElementById("subssearchi").value;else if(38===o){if(0===subslist.querySelectorAll("a").length)return;"number"==typeof selectedSeachResult?selectedSeachResult--:selectedSeachResult=selectedSeachResult=subslist.querySelectorAll("a").length-1,selectedSeachResult<0&&(selectedSeachResult=selectedSeachResult=subslist.querySelectorAll("a").length-1),subslist.querySelectorAll("a").forEach((e=>{e.classList.remove("selected")})),subslist.querySelectorAll("a")[selectedSeachResult].classList.add("selected"),document.getElementById("subssearchi").value=subslist.querySelectorAll("a")[selectedSeachResult].innerText}else if(40===o){if(0===subslist.querySelectorAll("a").length)return;"number"==typeof selectedSeachResult?selectedSeachResult++:selectedSeachResult=0,selectedSeachResult>subslist.querySelectorAll("a").length-1&&(selectedSeachResult=0),subslist.querySelectorAll("a").forEach((e=>{e.classList.remove("selected")})),subslist.querySelectorAll("a")[selectedSeachResult].classList.add("selected"),document.getElementById("subssearchi").value=subslist.querySelectorAll("a")[selectedSeachResult].innerText}}function unsubscribe(e){removelc("subs",e),subbtn=document.getElementById("subbtn"),subbtn.innerHTML="Subscribe"}function subscribe(e){addlc("subs",e),subbtn=document.getElementById("subbtn"),subbtn.innerHTML="Unsubscribe"}export function postbuilder(e){var t="";let o=localStorage.getItem("curmode")||"original";-1!=window.location.href.indexOf("comments.html")&&(o="original");var n=timeago(1e3*e.created_utc),l=e.stickied?" sticky":" ",s="";1!=checklc("a18","yes")&&(s=e.over_18?"over18":" ");var i="moderator"==e.distinguished?" moderator":" ";if(t+='<div class="post '+o+'" id="'+e.id+'">',"comp"==o)if(thumbnail=e.thumbnail,"self"!=thumbnail&&"spoiler"!=thumbnail&&"default"!=thumbnail&&""!=thumbnail&&"nsfw"!=thumbnail)"image"==thumbnail&&(thumbnail=e.preview.images[0].resolutions[0].url),t+='<div class="compthumb"><img src="'+thumbnail+'" alt="thumbnail"/></div><div class="rop">';else{thumbnail=thumbnail||"&bull;";const o=e?.preview?.images?.[0]?.resolutions?.[0]?.url||"none";t+="none"!=o?'<div class="compthumb"><img src="'+o+'" alt="thumbnail"/></div><div class="rop">':'<div class="comptext">'+thumbnail+'</div><div class="rop">'}if(t+='<div class="post_link'+l+" "+i+'"><a href="comments.html?url=https://www.reddit.com'+e.permalink+'">'+e.title+"</a></div>","comp"!=o){if(null!=e.selftext_html){var a=replaceRedditLinks(e.selftext_html);t+='<div class="postc selftext"><overflow-toggle show="+" hide="">'+htmlDecode(a)+"</overflow-toggle></div>"}var r=e.url_overridden_by_dest;e.url&&e.url.includes("reddit.com/gallery")&&(r=e.url),null!=e.crosspost_parent_list&&e.crosspost_parent_list.length>0||void 0!==e.crosspost_parent_list&&e.crosspost_parent_list.length>0?t+=postbuilder(e.crosspost_parent_list[0]):(void 0!==r&&null==e.removed_by_category&&(t+='<div class="urlpreview '+s+'">'+urlpreview(r,e)+'</div><div style="text-align: right;font-size:12px;"><a href="'+e.url+'"><small>Open URL</small></a></div>'),null!=e.removed_by_category&&(t+="Removed by "+e.removed_by_category),null!=e.poll_data&&(t+=pollbuilder(e)))}return t=t+'<div class="post_meta"><div class="flex-left"><a class="comments-icon icon" href="comments.html?url=https://old.reddit.com'+e.permalink+'">'+e.num_comments+'</a><span class="upvotes-icon icon">'+e.score+'</span><a class="ext-url-icon icon" href="'+e.url+'"></a>',t+='</div><div class="post_author flex-right"><a href="subreddit.html?r='+e.subreddit+'">'+e.subreddit_name_prefixed+'</a> <a class="small-hidden" href="user.html?u='+e.author+'">'+e.author+"</a> "+n+"</div>",null!==localStorage.getItem("refreshToken")&&window.location.href.includes("comments.html")&&(t+=" &bull; <span onclick=\"replyto('t3_"+e.id+"')\">Reply</span>"),t+="</div>","comp"==o&&(t+="</div>"),t+="</div>"}function preloadImage(e){let t=document.createElement("div");t.innerHTML=`<img src="${e}" />`,document.body.appendChild(t),setTimeout((function(){document.body.removeChild(t)}),1)}function closegal(){document.getElementById("newgallery").outerHTML=""}function galleryopen(e){const t=document.createElement("div");t.id="newgallery",document.getElementsByTagName("body")[0].appendChild(t),t.innerHTML='<span id="closegal" onclick="closegal();">Close</span>',document.querySelectorAll('[data-id="'+e+'"]').forEach((e=>{t.innerHTML+='<div class="displayimg"><img src="'+e.getAttribute("data-msrc")+'"></div>'}))}function previewImage(e){var t;try{var o=e.preview.images[0].resolutions[0];e.preview.images[0].resolutions.forEach((e=>{e.width&&e.width>=o.width&&e.width<=640&&(o=e)})),t=o.url}catch(o){t=e.thumbnail}return"default"===t&&(t=""),t}function urlpreview(e,t){var o="";if(e.match(/.(jpg|jpeg|png)$/i))o+='<div class="postc singleimage"><img src="'+e+'"/></div>';else if(e.match(/.(gif)$/i)){const l=t?.preview?.images?.[0]?.variants?.mp4?.source?.url||"none";if("none"==l)o+='<div class="postc singleimage"><img src="'+e+'"/></div>';else{c=void 0===(c=t.preview)?t.thumbnail:t.preview.images[0].source.url;var n=previewImage(t);o+='<div class="postc video generic-gif">',o+='<a href="#" data-target="'+t.id+'" class="lazy-video imgur-com">',o+='<img  loading="lazy" src="'+n+'#t=0.001"/>',o+="</a>",o+='<template id="vt-'+t.id+'">',o+='<video id="v'+t.id+'" src="'+l+'#t=0.001" poster="'+n+'" width="100%" preload="none" loop controls>',o+="</video>",o+="</template>",o+="</div>"}}else if(e.match(/www.reddit.com\/gallery/g)){o+='<div class="postc gallery">';let e=t.media_metadata,n=t.gallery_data;const i={};n&&n.items.forEach(((t,o)=>{const n=t.media_id;e.hasOwnProperty(n)&&(i[n]=e[n])}));for(var l in o+='<slide-show controls="pagination navigation" loop>',i)if("failed"!=i[l].status&&"unprocessed"!=i[l].status){var s=i[l].s.u;s=void 0===s?i[l].s.gif:s.replace("preivew.redd","i.redd");i[l].p[0].u;o+='<img style="width:100%;height:auto" draggable="false" src="'+s+'" />'}o+="</slide-show>",o+="</div>"}else if(e.match(/v.redd.it/g)){if(o+='<div class="postc video vreddit">',null!=t.secure_media){var i=t.secure_media.reddit_video.dash_url,a=t.secure_media.reddit_video.hls_url,r=t.secure_media.reddit_video.fallback_url,c=t.preview;c=void 0===c?t.thumbnail:t.preview.images[0].source.url,(n=previewImage(t))?(o+='<a href="#" data-target="'+t.id+'" class="lazy-video">',o+='<img loading="lazy" src="'+n+'#t=0.001"/>',o+="</a>",o+='<template id="vt-'+t.id+'">',o+='<video id="v'+t.id+'" src="'+i+'#t=0.001" data-fallback="'+r+'" data-hls="'+a+'" poster="'+c+'" width="100%" preload="metadata" class="reddit_hls"  controls>',o+="</video>",o+="</template>"):(o+='<video id="v'+t.id+'" src="'+i+'#t=0.001" data-fallback="'+r+'" data-hls="'+a+'" poster="'+c+'" width="100%" preload="metadata" class="reddit_hls"  controls>',o+="</video>")}else o+="crosspost";o+="</div>"}else if(e.match(/redgifs/g)&&t.preview){if(o+='<div class="postc video redgifs">',t.secure_media)if(void 0===(i=t.secure_media.oembed.thumbnail_url))o+=i='<iframe src="'+(i=e.replace("redgifs.com/watch/","redgifs.com/ifr/"))+'?autoplay=0" class="gifframe"></iframe>';else{t.preview&&void 0!==t.preview.reddit_video_preview?i=t.preview.reddit_video_preview.fallback_url:t.secure_media.oembed.thumbnail_url&&(i=t.secure_media.oembed.thumbnail_url),i=i.replace("size_restricted.gif","mobile.mp4");n=previewImage(t);o+='<a href="#" data-target="'+t.id+'" class="lazy-video">',o+='<img  loading="lazy" src="'+n+'#t=0.001"/>',o+="</a>",o+='<template id="vt-'+t.id+'">',o+='<video id="v'+t.id+'" src="'+i+'" poster="'+n+'" width="100%" preload="metadata" controls>',o+="</video>",o+="</template>"}o+="</div>"}else if(e.match(/gfycat.com/g))o+='<div class="postc video gyfcat">',null==t.secure_media||void 0===t.secure_media.oembed.thumbnail_url?o+=i='<iframe src="'+(i=e.replace("gfycat.com/","gfycat.com/ifr/"))+'?autoplay=0" class="gifframe"></iframe>':(void 0!==t.preview.reddit_video_preview?i=t.preview.reddit_video_preview.fallback_url:t.secure_media.oembed.thumbnail_url&&(i=t.secure_media.oembed.thumbnail_url),o+='<video src="'+(i=i.replace("size_restricted.gif","mobile.mp4"))+'" poster="'+t.thumbnail+'" width="100%" height="240" preload="metadata" controls> </video>'),o+="</div>";else if(e.match(/i.imgur.com(.*?)gifv/g)){o+='<div class="postc video imgur">';let l=e.replace(".gifv",".mp4");n=previewImage(t);o+='<a href="#" data-target="'+t.id+'" class="lazy-video">',o+='<img  loading="lazy" src="'+n+'#t=0.001"/>',o+="</a>",o+='<template id="vt-'+t.id+'">',o+='<video  id="v'+t.id+'" src="'+l+'" poster="'+n+'#t=0.001" width="100%" preload="none" controls class="lazy">',o+="</video>",o+="</template>",o+="</div>"}else{var d=previewImage(t)||"";d?(o+='<a href="'+e+'" class="postc singleimage url">',o+='<img src="'+d+'"/>',o+="</a>"):o+='<div class="postc link"><a href="'+e+'" >'+d+e+"</a></div>",o=replaceRedditLinks(o)}return o}function pollbuilder(e){let t='<div class="poll">';for(var o in e.poll_data.options){let n=e.poll_data.options[o].vote_count;void 0===n&&(n=" "),t+='<div class="polloption"><span class="polloptiontext">'+e.poll_data.options[o].text+'</span> <span  class="votecount">'+n+"</span>"," "!=n&&(t+='<div class="optionmeter" style="width:'+e.poll_data.options[o].vote_count/e.poll_data.total_vote_count*100+'%;"></div>'),t+="</div>"}return t+='<div class="totalvotes">Total votes: '+e.poll_data.total_vote_count+"</div>",t+="</div>",t}function playaud(e){document.getElementById(e).play()}function pauseaud(e){document.getElementById(e).pause()}function seeked(e){document.getElementById("a"+e).currentTime=document.getElementById("v"+e).currentTime}export function getget(e,t=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");var o=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}function runhsl_on_vid(e){e.parentElement;e.classList.add("goner");if(/iPhone|iPad/i.test(navigator.userAgent))e.src=e.getAttribute("data-hls");else{dashjs.MediaPlayer().create().initialize(e,e.src,!0)}}function runhsl(){document.querySelectorAll(".reddit_hls:not(.goner)").forEach((e=>{e.parentElement;e.classList.add("goner");if(/iPhone|iPad/i.test(navigator.userAgent))e.src=e.getAttribute("data-hls");else{dashjs.MediaPlayer().create().initialize(e,e.src,!1)}}));document.querySelectorAll(".gtumb").forEach((e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-id");document.getElementById("mi_"+e).src=this.getAttribute("data-msrc"),document.querySelectorAll('[data-id="'+e+'"]').forEach((e=>e.classList.remove("actv"))),this.classList.add("actv"),document.getElementById("mi_"+e).scrollIntoView()}))}))}function shareit(){if(navigator.share){const e=window.location.href,t={title:document.title,url:e};navigator.share(t).then((()=>{console.log("Shared successfully")})).catch((e=>{console.error("Error sharing:",e)}))}else{const e=window.location.href,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),alert("Link copied to clipboard: "+e)}}function replyto(e){document.getElementById("popitup").style.display="block",document.getElementById("cmtid").value=e,document.getElementById("actype").value="c";let t=e.replace(/^(t1_|t3_)/,"");"post"!=document.getElementById(t).className?document.getElementById("helptext").textContent="Reply to: "+document.getElementById(t).querySelector(".comment_text").textContent:document.getElementById("helptext").textContent="Reply to:"+document.getElementById(t).querySelector(".post_link a").textContent,document.getElementById("commentText").focus()}function editto(e){document.getElementById("popitup").style.display="block",document.getElementById("cmtid").value=e;let t=e.replace(/^(t1_|t3_)/,"");document.getElementById("commentText").value=document.getElementById(t).querySelector(".comment_text").textContent,document.getElementById("actype").value="e",document.getElementById("helptext").textContent="Editing: "+document.getElementById(t).querySelector(".comment_text").textContent,document.getElementById("commentText").focus()}function deleteto(e){confirm("Are you sure you want to delete this?")&&(document.getElementById("cmtid").value=e,document.getElementById("actype").value="d",apiAction())}function inboxto(){document.getElementById("actype").value="i",apiAction()}function apiAction(){const e=localStorage.getItem("accessToken"),t=localStorage.getItem("expiresIn"),o=localStorage.getItem("refreshToken"),n=localStorage.getItem("clientId"),l=localStorage.getItem("clientSecret"),s=document.getElementById("actype").value;if(e&&t){const i=Date.now(),a=parseInt(t);if(i<a)"c"==s?submitComment(e):"e"==s?editComment(e):"d"==s?delComment(e):"i"==s&&getInbox(e);else{fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${btoa(`${n}:${l}`)}`},body:`grant_type=refresh_token&refresh_token=${o}`}).then((e=>e.json())).then((t=>{const o=t.access_token,n=t.refresh_token,l=t.expires_in,a=i+1e3*l;localStorage.setItem("accessToken",o),localStorage.setItem("refreshToken",n),localStorage.setItem("expiresIn",a.toString()),"c"==s?submitComment(e):"e"==s?editComment(e):"d"==s?delComment(e):"i"==s&&getInbox(e)})).catch((e=>{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",alert("Error refreshing token:",e)}))}}else window.location.href="login.html"}function submitComment(e){document.getElementById("cmntbtn").disabled=!0,document.getElementById("cmntbtn").innerHTML="Submitting...";const t=document.getElementById("cmtid").value,o=document.getElementById("commentText").value;fetch("https://oauth.reddit.com/api/comment",{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"},body:`api_type=json&text=${encodeURIComponent(o)}&thing_id=${t}`}).then((e=>e.json())).then((e=>{if(e.errors&&e.errors.length>0)document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",alert("Error submitting comment:"+e.errors);else{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",document.getElementById("popitup").style.display="none",document.getElementById("commentText").value="";let e=t.replace(/^(t1_|t3_)/,""),n="ccp0";if("post"!=document.getElementById(e).className){let t=document.getElementById(e).className.match(/ccp\d+/)[0].replace("ccp","");t=Math.floor(t)+1,n="ccp"+t}document.getElementById(e).insertAdjacentHTML("afterEnd",'<div class="comment '+n+'"><div class="comment_author"><span class="authorttext ">You</span>  <span class="comment_meta">1 votes • Just now </span></div><div class="comment_text">'+o+"</div></div>")}})).catch((e=>{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").value="Submit",alert("Error submitting comment:"+e)}))}function editComment(e){document.getElementById("cmntbtn").disabled=!0,document.getElementById("cmntbtn").innerHTML="Submitting...";const t=document.getElementById("cmtid").value,o=document.getElementById("commentText").value;fetch("https://oauth.reddit.com/api/editusertext",{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"},body:`api_type=json&text=${encodeURIComponent(o)}&thing_id=${t}`}).then((e=>e.json())).then((e=>{if(e.errors&&e.errors.length>0)document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",alert("Error editing comment:"+e.errors);else{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").value="Submit",document.getElementById("popitup").style.display="none",document.getElementById("commentText").value="";let e=t.replace(/^(t1_|t3_)/,"");document.getElementById(e).querySelector(".comment_text").textContent=o}})).catch((e=>{document.getElementById("cmntbtn").disabled=!1,document.getElementById("cmntbtn").innerHTML="Submit",alert("Error editing comment:"+e)}))}function delComment(e){const t=document.getElementById("cmtid").value;fetch("https://oauth.reddit.com/api/del",{method:"POST",headers:{Authorization:`bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"},body:`id=${t}`}).then((e=>e.json())).then((e=>{if(e.errors&&e.errors.length>0)alert("Error deleting comment:"+e.errors);else{let e=t.replace(/^(t1_|t3_)/,"");document.getElementById(e).style.display="none"}})).catch((e=>{alert("Error deleting comment:"+e)}))}function getInbox(e){fetch("https://oauth.reddit.com/message/inbox",{method:"GET",headers:{Authorization:`Bearer ${e}`}}).then((e=>e.json())).then((e=>{if(e.error)console.error("Error fetching inbox messages:",e.error);else{const t=e.data.children;console.log(t);let o="";t.forEach((e=>{const{kind:t,inboxMessages:{author:n,created_utc:l,subject:s,link_title:i,body_html:a,tname:r,context:c}}=e,d=new Date(1e3*l),m=`${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()} - ${d.getHours()}:${d.getMinutes()}`;"t1"===t?(o+=`<div class="inboxmsgwrap"><div class="ibxmeta"><span class="ibxauthor"><a href="user.html?u=${n}">u/${n}</a> &bull;  <span class="ibxtime">${m}</span></span></div>`,o+=`<div class="ibxsub">${s}</div>`,o+=`<div class="ibxlink"><a href="comments.html?url=https://www.reddit.com${c}">${i}</a></div>`,o+=`<div class="ibxmsg">${a}</div>`,o+=`<div class="ibxactions"><button onclick="replyto('${r}')">Reply</button></div></div>`):"t4"===t&&(o+=`<div class="inboxmsgwrap"><div class="ibxmeta"><span class="ibxauthor"><a href="user.html?u=${n}">u/${n}</a> &bull;  <span class="ibxtime">${m}</span></span></div>`,o+=`<div class="ibxsub">${s}</div>`,o+=`<div class="ibxmsg">${a}</div></div>`,o+=`<div class="ibxactions"><button onclick="replyto('${r}')">Reply</button></div></div>`)})),document.getElementById("inboxbody").innerHTML=o}})).catch((e=>{console.error("Error fetching inbox messages:",e)}))}function setupUnloadVideo(e){const t=new IntersectionObserver((t=>{if(t[0].intersectionRatio<=0){let t=e.parentNode&&e.parentNode.querySelector(".lazy-video.hidden");t&&(t.classList.remove("hidden"),e.remove())}}));setTimeout((()=>{console.log("setupUnloadVideo",e.id),t.observe(e)}),1e3)}function is_fullscreen(){return!!document.fullscreenElement}function setupPauseVideo(e){new IntersectionObserver((t=>{t[0].intersectionRatio<=0&&e.pause()})).observe(e)}function nextItem(e=!1){++activePostIdx>document.querySelectorAll(".post").length-1&&(activePostIdx=document.querySelectorAll(".post").length-1),activatePost(e)}function nextComment(){for(var e=document.querySelectorAll(".comment"),t=activeCommentIdx+1;t<e.length;t++)if(!e[t].classList.contains("collapsed-hidden")){activeCommentIdx=t;break}activateComment(!0)}function prevItem(e=!1){--activePostIdx<0&&(activePostIdx=0),activatePost(e)}function prevComment(){for(var e=document.querySelectorAll(".comment"),t=activeCommentIdx-1;t>=0;t--)if(!e[t].classList.contains("collapsed-hidden")){activeCommentIdx=t;break}activateComment(!0)}function openComment(){var e=document.querySelector(".current-comment");e&&collapseComment(e)}function collapseCurrentComment(){var e=document.querySelector(".current-comment");e&&collapseComment(e)}function openItem(){var e=document.querySelector(".current-post");e&&(e.querySelector("a.lazy-video")?e.querySelector("a.lazy-video").click():e.querySelector(".singleimage.url")?window.location.href=e.querySelector(".singleimage.url").href:e.querySelector(".singleimage img")&&(document.body.classList.contains("jw-modal-open")?closeModal():postModal(e)))}function checkVisible(e){var t=e.getBoundingClientRect(),o=Math.max(document.documentElement.clientHeight,window.innerHeight);return!(t.bottom<0||t.top-o>=48)}function activateComment(e=!1){var t=document.querySelector(".current-comment");t&&t.classList.remove("current-comment"),document.querySelector(".comment")&&(t=document.querySelectorAll(".comment")[activeCommentIdx]).classList.add("current-comment"),t&&!checkVisible(t)&&window.scrollTo({top:t.offsetTop-46,behavior:"smooth"})}function activatePost(e=!1){var t=document.querySelector(".current-post");t&&t.classList.remove("current-post"),document.querySelector(".post")&&(t=document.querySelectorAll(".post")[activePostIdx]).classList.add("current-post"),e&&t&&window.scrollTo({top:t.offsetTop-46,behavior:"smooth"})}const _closeModalHandler=function(e){if(document.body.classList.contains("jw-modal-open"))return closeModal(),e.preventDefault(),!1};function initGestures(e){if(!window.DOMMatrix){if(!window.WebKitCSSMatrix)throw new Error("Couldn't find a DOM Matrix implementation");window.DOMMatrix=window.WebKitCSSMatrix}let t,o=new DOMMatrix;e.style.transformOrigin="0 0",okzoomer(document.querySelector("#dialog"),{startGesture(n){e.style.transform="",t=getOrigin(e,n),applyMatrix(e,gestureToMatrix(n,t).multiply(o))},doGesture(n){applyMatrix(e,gestureToMatrix(n,t).multiply(o))},endGesture(n){o=gestureToMatrix(n,t).multiply(o),applyMatrix(e,o)}})}function postModal(e){if(document.body.offsetWidth<480)return;let t=document.querySelector("#dialog");if(e.querySelector(".singleimage img")){var o=e.querySelector(".singleimage img");t.querySelector(".jw-dialog-innner").appendChild(o.cloneNode(!0)),t.classList.add("open"),document.body.classList.add("jw-modal-open"),document.addEventListener("click",_closeModalHandler),initGestures(document.querySelector("#dialog .jw-dialog-innner img"))}}function closeModal(){let e=document.getElementById("dialog");e.classList.remove("open"),document.body.classList.remove("jw-modal-open"),e.querySelector(".jw-dialog-innner").childNodes.forEach((e=>e.remove())),document.removeEventListener("click",_closeModalHandler)}export function postsLoadedCallback(e=!0){console.log("postsLoadedCallback",e),activatePost(!1),document.body.classList.contains("comments")&&activateComment()}function updateCurrentPostIdxOnScroll(){var e=!1;document.querySelectorAll(".post").forEach(((t,o)=>{!e&&t.offsetTop>window.scrollY&&(activePostIdx=o,activatePost(!1),e=!0)}))}export function setTitle(e){document.title=e+" • RDX"}export function collapseComment(e){let t,o,n=e,l=n,s=Math.abs(n.classList[1].replace("ccp",""));if("1"==n.getAttribute("iscollasped")){for(;t=l.nextSibling;){if(t.classList.contains("comment")){if(o=Math.abs(t.classList[1].replace("ccp","")),!(o>s))break;t.style.display="block",t.classList.remove("collapsed-hidden")}else t.style.display="block",t.classList.remove("collapsed-hidden");l=t}n.classList.toggle("collapsed"),n.setAttribute("iscollasped","0")}else{for(;t=l.nextSibling;){if(t.classList.contains("comment")){if(o=Math.abs(t.classList[1].replace("ccp","")),!(o>s))break;t.style.display="none",t.classList.add("collapsed-hidden")}else t.style.display="none",t.classList.add("collapsed-hidden");l=t}n.classList.toggle("collapsed"),n.setAttribute("iscollasped","1")}}let ticking=!1;document.addEventListener("scroll",(e=>{window.scrollY;ticking||(window.requestAnimationFrame((()=>{updateCurrentPostIdxOnScroll(),ticking=!1})),ticking=!0)})),addEventListener("DOMContentLoaded",(e=>{var t='<form class="search" action="search.html"><input type="search" name="q" value="'+(getget("q")?getget("q"):"")+'"/>';if(t+='<input type="submit" value="Search"/><br style="clear:both;">',(window.location.href.indexOf("?r=")>-1||window.location.href.indexOf("&r=")>-1)&&(t+='<input type="checkbox" id="chk1" name="r" value="'+getget("r")+'" checked><label for="chk1"> Only search r/'+getget("r")+"</label>"),(window.location.href.indexOf("?u=")>-1||window.location.href.indexOf("&u=")>-1)&&(t+='<input type="checkbox" id="chk1" name="u" value="'+getget("u")+'" checked><label for="chk1"> Only search u/'+getget("u")+"</label>"),window.location.href.indexOf("/r/")>-1){var o=window.location.href.match(/r\/(.*?)\//s)[1];t+='<input type="checkbox" id="chk1" name="r" value="'+o+'" checked><label for="chk1"> Only search r/'+o+"</label>"}t+="</form>",document.getElementById("leftbar").insertAdjacentHTML("afterBegin",t),document.addEventListener("click",(e=>{if(e.target.closest("a.lazy-video")&&e.target.closest("a").dataset.target){let t=e.target.closest("a");t.parentNode.style.height=t.offsetHeight+"px";let o=t.dataset.target,n=document.getElementById("vt-"+o).content.cloneNode(!0);t.classList.add("hidden"),t.parentNode.appendChild(n);let l=document.getElementById("v"+o);return l.classList.contains("reddit_hls")?runhsl_on_vid(l):l.play(),l.addEventListener("play",(e=>{window.setTimeout((()=>{setupPauseVideo(l)}),2e3)})),window.setTimeout((()=>{l.play(),l.addEventListener("pause",(e=>{setupUnloadVideo(l)}))}),400),e.preventDefault(),!1}if(e.target.closest(".postc.singleimage")){var t=e.target.closest(".postc.singleimage"),o=e.target.closest(".post");if(t.classList.contains("url"))return;postModal(o)}})),document.addEventListener("keydown",(e=>{if(!document.querySelector("input:focus"))switch(e.key){case"j":case"J":case"ArrowDown":e.preventDefault(),document.body.classList.contains("comments")?nextComment():nextItem(!0);break;case"k":case"K":case"ArrowUp":e.preventDefault(),document.body.classList.contains("comments")?prevComment():prevItem(!0);break;case"Enter":case"ArrowRight":e.preventDefault(),document.body.classList.contains("comments")?openComment():openItem();break;case"Escape":case"ArrowLeft":e.preventDefault(),document.body.classList.contains("comments")?collapseCurrentComment():closeModal()}})),document.getElementById("plus").addEventListener("click",(e=>{e.preventDefault(),toggle("leftbar")})),document.getElementById("taptoopenmenu").addEventListener("click",(e=>{e.preventDefault(),toggle("subssearch")})),document.getElementById("menu").addEventListener("click",(e=>{e.preventDefault(),toggle("rightbar")})),document.getElementById("subssearchi").addEventListener("keyup",(e=>{searchsubs(e.target.value,e)}));const n=document.getElementById("subbtn");n&&n.addEventListener("click",(e=>{e.preventDefault();var t=e.target.dataset.target;checklc("subs",t)?unsubscribe(t):subscribe(t)}))}));