<!doctype html>
<html>
<head>
    <title>RDX for Reddit -  Apollo For Reddit Inspired Web Viewer</title>
    <meta name="description" content="rdx for reddit is a fast, lightweight mobile Web Viewer for Reddit based on Apollo. Mobile friendly reader for Reddit. Browse Reddit without Ads."/>
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="icon" href="favicon.png">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="rdx" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
     <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="styles.min.css" type="text/css">
    <link rel="stylesheet" href="/r/slide-show/slide-show.css?v=iqb8TMkY" />
    <link rel="stylesheet" href="/r/overflow-toggle/overflow-toggle.css?v=iqb8TMkY" />
    <script type="module" src="/r/slide-show/slide-show.js?v=iqb8TMkY"></script>
    <script type="module" src="/r/overflow-toggle/overflow-toggle.js?v=iqb8TMkY"></script>
    <script src="/r/dash.all.min.js"></script>
</head>
<body>
    <header id="header">
        <div id="pagetitle">
            <span id="plus"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="#fff" role="img" aria-label="Menu"><path d="M140.001-254.616v-59.999h679.998v59.999H140.001Zm0-195.385v-59.998h679.998v59.998H140.001Zm0-195.384v-59.999h679.998v59.999H140.001Z"></path></svg></span>
            <span id="taptoopenmenu"><span id="pagetitletext">Loading...</span>
            <svg aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" id="icon-target" style=""><path fill="currentColor" d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"></path></svg></span>
            <span id="menu"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="#fff" role="img" aria-label="Sort and other options"><path d="M411.155-260.001V-320h137.306v59.999H411.155Zm-155-190v-59.998H703.46v59.998H256.155ZM140.001-640v-59.999h679.998V-640H140.001Z"/></svg></span>
        </div>
        <div id="menus">
            <div id="subssearch" class="hidden">
                <input type="text" id="subssearchi" name="qury" autocomplete="off">
                <div id="subslist"></div>
            </div>
            <div id="leftbar" class="hidden">
                <div class="list">
                    <a href="index.html" class="homelinks halfit">/r/all</a><a href="home.html" class="homelinks halfit">Home</a><a href="saved.html" class="homelinks halfit">Saved</a><a href="settings.html" class="homelinks halfit">Settings</a>
                    <div id="subscribed"></div>
                </div>
            </div>
            <div id="rightbar" class="hidden"></div>
        </div>
    </header>
    <div id="body"></div>

<div id="paginate"></div>

<script type="module">
import { getget, setTitle, makereq, postbuilder, postsLoadedCallback, collapseComment, cbuilder } from "./functions.min.js";
import { loadcomments } from './comments.min.js';

var thisthread;
var pagenum = 0;


document.addEventListener('click', (e) => {
    if (e.target.classList.contains('load-more-comments')) {
        e.preventDefault();
        loadmore(document.getElementById('paginate').dataset.cids.split(' '));
    }
})


function loadmore(cids){
    if (!cids) {
        return
    }
    var urljson = '';

    for (var i = pagenum*60; i < cids.length; i++){
        urljson += cids[i]+',';

        if(i > 60*(pagenum+1)) {
            pagenum = pagenum + 1;
            break;
        }
    }

    var req = new XMLHttpRequest();
    req.responseType = 'json';
    urljson = urljson.replace(/,\s*$/, "");

    req.open('GET','https://www.reddit.com/r/'+thisthread['subreddit']+'/api/morechildren.json?api_type=json&&link_id='+thisthread['name']+'&limit=500&r=AskReddit&children='+urljson, true);
    req.onload  = function() {
        var jsonResponse = req.response;
        //thisthread = jsonResponse[0]['data']['children'][0]['data'];
        //document.getElementById('pagetitletext').innerHTML = thisthread['subreddit']
        var comments = jsonResponse['json']['data']['things'];
        document.getElementById('body').innerHTML += loadcomments(comments);

    };
    req.send(null);
}

function opencmenu(cid){
    cidi = document.getElementById(cid).getAttribute('menushown');

    if(cidi == 'yes'){
       document.getElementById(cid+'cc').remove();
       document.getElementById(cid).setAttribute('menushown','no');
       console.log('yy');
    } else {
        htmltoc = '<div class="cmenu" id="'+cid+'cc"><a onclick="">Save</a></div>';
        document.getElementById(cid).insertAdjacentHTML("afterBegin", htmltoc);
        document.getElementById(cid).setAttribute('menushown','yes');
    }
}

document.body.classList.add('comments')



var url = getget('url'), roqs = url.split('?');
url = roqs[0];
roqs = roqs[1];
url = url.replace(/https:\/\/reddit.com/g, 'https://www.reddit.com');
url = url.replace(/amp.reddit.com/g, 'www.reddit.com');
url = url.replace(/m.reddit.com/g, 'www.reddit.com');
url = url.replace(/i.reddit.com/g, 'www.reddit.com');
var links = '<a href="comments.html?url='+url+'&sort=new">New</a><a href="comments.html?url='+url+'&sort=best">Best</a><a href="comments.html?url='+url+'&sort=top">Top</a><a href="comments.html?url='+url+'&sort=controversial">Controversial</a><a href="comments.html?url='+url+'&sort=old">Old</a><a href="comments.html?url='+url+'&sort=qa">QnA</a><a onclick="saveit(this)" id="sharebutton" style="border-top: 5px solid var(--greyc);">Save</a><a onclick="shareit();" id="sharebutton">Share</a>';
document.getElementById('rightbar').innerHTML = links;
url = url+'.json?limit=500';

if(getget('sort') != null){
    url = url+'&sort='+getget('sort');

}
url = url+'&'+roqs;

var req = new XMLHttpRequest();
req.responseType = 'json';
req.open('GET', url, true);
req.onload  = function() {
    var jsonResponse = req.response;
    thisthread = jsonResponse[0]['data']['children'][0]['data'];
    document.getElementById('body').innerHTML += postbuilder(thisthread);
    document.getElementById('pagetitletext').innerHTML = thisthread['subreddit'];
    setTitle(thisthread['title']);
    var comments = jsonResponse[1]['data']['children'];
    document.getElementById('body').innerHTML += loadcomments(comments);

    let commentsdivs =   document.getElementById('body').getElementsByClassName('comment');
    for (let i=0; i < commentsdivs.length; i++) {
        commentsdivs[i].addEventListener('dblclick', (e) => { collapseComment(e.target.closest('.comment')) }  );
    }
    //runhsl();
    postsLoadedCallback(true);
};
req.send(null);
</script>

<div class="footer">
</div>
<div id="dialog" class="jw-modal">
  <div class="jw-modal-body">
    <div class="jw-dialog-innner"></div>
    <a href="#" class="close-modal-button" title="close"></a>
  </div>
</div>
  <div id="popitup" style="display:none;">
    <span onclick="document.getElementById('popitup').style.display='none'">Cancel</span>
    <div id="helptext"></div>
    <textarea class="cmntarea" id="commentText" placeholder="Write a reply!" required></textarea>
    <input id="cmtid" value="" type="hidden"/>
    <input id="actype" value="" type="hidden"/>
    <button id="cmntbtn" onclick="apiAction();">Submit</button>
  </div> <!-- rdx -->

</body></html>
